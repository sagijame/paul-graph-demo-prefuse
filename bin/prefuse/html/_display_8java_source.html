<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>Demo: D:/Baul/Workspace/JavaProject/workspace/EvoComm 0.5/graph/prefuse/Display.java Source File</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />

<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>

</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">Demo
   &#160;<span id="projectnumber">1.0</span>
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.6.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="headertitle">
<div class="title">D:/Baul/Workspace/JavaProject/workspace/EvoComm 0.5/graph/prefuse/Display.java</div>  </div>
</div><!--header-->
<div class="contents">
<div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="keyword">package </span>prefuse;
<a name="l00002"></a>00002 
<a name="l00003"></a>00003 <span class="keyword">import</span> java.awt.Color;
<a name="l00004"></a>00004 <span class="keyword">import</span> java.awt.Dimension;
<a name="l00005"></a>00005 <span class="keyword">import</span> java.awt.Font;
<a name="l00006"></a>00006 <span class="keyword">import</span> java.awt.Graphics;
<a name="l00007"></a>00007 <span class="keyword">import</span> java.awt.Graphics2D;
<a name="l00008"></a>00008 <span class="keyword">import</span> java.awt.GraphicsEnvironment;
<a name="l00009"></a>00009 <span class="keyword">import</span> java.awt.Image;
<a name="l00010"></a>00010 <span class="keyword">import</span> java.awt.Point;
<a name="l00011"></a>00011 <span class="keyword">import</span> java.awt.Rectangle;
<a name="l00012"></a>00012 <span class="keyword">import</span> java.awt.RenderingHints;
<a name="l00013"></a>00013 <span class="keyword">import</span> java.awt.event.ActionEvent;
<a name="l00014"></a>00014 <span class="keyword">import</span> java.awt.event.ActionListener;
<a name="l00015"></a>00015 <span class="keyword">import</span> java.awt.event.KeyEvent;
<a name="l00016"></a>00016 <span class="keyword">import</span> java.awt.event.KeyListener;
<a name="l00017"></a>00017 <span class="keyword">import</span> java.awt.event.MouseEvent;
<a name="l00018"></a>00018 <span class="keyword">import</span> java.awt.event.MouseListener;
<a name="l00019"></a>00019 <span class="keyword">import</span> java.awt.event.MouseMotionListener;
<a name="l00020"></a>00020 <span class="keyword">import</span> java.awt.event.MouseWheelEvent;
<a name="l00021"></a>00021 <span class="keyword">import</span> java.awt.event.MouseWheelListener;
<a name="l00022"></a>00022 <span class="keyword">import</span> java.awt.geom.AffineTransform;
<a name="l00023"></a>00023 <span class="keyword">import</span> java.awt.geom.NoninvertibleTransformException;
<a name="l00024"></a>00024 <span class="keyword">import</span> java.awt.geom.Point2D;
<a name="l00025"></a>00025 <span class="keyword">import</span> java.awt.geom.Rectangle2D;
<a name="l00026"></a>00026 <span class="keyword">import</span> java.awt.image.BufferedImage;
<a name="l00027"></a>00027 <span class="keyword">import</span> java.io.OutputStream;
<a name="l00028"></a>00028 <span class="keyword">import</span> java.util.Iterator;
<a name="l00029"></a>00029 <span class="keyword">import</span> java.util.logging.Logger;
<a name="l00030"></a>00030 
<a name="l00031"></a>00031 <span class="keyword">import</span> javax.imageio.ImageIO;
<a name="l00032"></a>00032 <span class="keyword">import</span> javax.swing.JComponent;
<a name="l00033"></a>00033 <span class="keyword">import</span> javax.swing.JTextArea;
<a name="l00034"></a>00034 <span class="keyword">import</span> javax.swing.JTextField;
<a name="l00035"></a>00035 <span class="keyword">import</span> javax.swing.JToolTip;
<a name="l00036"></a>00036 <span class="keyword">import</span> javax.swing.KeyStroke;
<a name="l00037"></a>00037 <span class="keyword">import</span> javax.swing.text.JTextComponent;
<a name="l00038"></a>00038 
<a name="l00039"></a>00039 <span class="keyword">import</span> prefuse.activity.Activity;
<a name="l00040"></a>00040 <span class="keyword">import</span> prefuse.activity.SlowInSlowOutPacer;
<a name="l00041"></a>00041 <span class="keyword">import</span> prefuse.controls.Control;
<a name="l00042"></a>00042 <span class="keyword">import</span> prefuse.data.expression.AndPredicate;
<a name="l00043"></a>00043 <span class="keyword">import</span> prefuse.data.expression.BooleanLiteral;
<a name="l00044"></a>00044 <span class="keyword">import</span> prefuse.data.expression.Predicate;
<a name="l00045"></a>00045 <span class="keyword">import</span> prefuse.data.expression.parser.ExpressionParser;
<a name="l00046"></a>00046 <span class="keyword">import</span> prefuse.render.Renderer;
<a name="l00047"></a>00047 <span class="keyword">import</span> prefuse.util.ColorLib;
<a name="l00048"></a>00048 <span class="keyword">import</span> prefuse.util.StringLib;
<a name="l00049"></a>00049 <span class="keyword">import</span> prefuse.util.UpdateListener;
<a name="l00050"></a>00050 <span class="keyword">import</span> prefuse.util.collections.CopyOnWriteArrayList;
<a name="l00051"></a>00051 <span class="keyword">import</span> prefuse.util.display.BackgroundPainter;
<a name="l00052"></a>00052 <span class="keyword">import</span> prefuse.util.display.Clip;
<a name="l00053"></a>00053 <span class="keyword">import</span> prefuse.util.display.DebugStatsPainter;
<a name="l00054"></a>00054 <span class="keyword">import</span> prefuse.util.display.ExportDisplayAction;
<a name="l00055"></a>00055 <span class="keyword">import</span> prefuse.util.display.ItemBoundsListener;
<a name="l00056"></a>00056 <span class="keyword">import</span> prefuse.util.display.PaintListener;
<a name="l00057"></a>00057 <span class="keyword">import</span> prefuse.util.display.RenderingQueue;
<a name="l00058"></a>00058 <span class="keyword">import</span> prefuse.visual.VisualItem;
<a name="l00059"></a>00059 <span class="keyword">import</span> prefuse.visual.expression.VisiblePredicate;
<a name="l00060"></a>00060 <span class="keyword">import</span> prefuse.visual.sort.ItemSorter;
<a name="l00061"></a>00061 
<a name="l00062"></a>00062 
<a name="l00106"></a>00106 @SuppressWarnings(<span class="stringliteral">&quot;serial&quot;</span>)
<a name="l00107"></a><a class="code" href="classprefuse_1_1_display.html">00107</a> public class <a class="code" href="classprefuse_1_1_display.html">Display</a> extends JComponent {
<a name="l00108"></a>00108         
<a name="l00109"></a>00109     <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Logger s_logger 
<a name="l00110"></a>00110         = Logger.getLogger(<a class="code" href="classprefuse_1_1_display.html">Display</a>.class.getName());
<a name="l00111"></a>00111     
<a name="l00112"></a>00112     <span class="comment">// visual item source</span>
<a name="l00113"></a>00113     <span class="keyword">private</span> <a class="code" href="classprefuse_1_1_visualization.html">Visualization</a> m_vis;
<a name="l00114"></a>00114     <span class="keyword">protected</span> AndPredicate  m_predicate = <span class="keyword">new</span> AndPredicate();
<a name="l00115"></a>00115     
<a name="l00116"></a>00116     <span class="comment">// listeners</span>
<a name="l00117"></a>00117     <span class="keyword">protected</span> CopyOnWriteArrayList m_controls = <span class="keyword">new</span> CopyOnWriteArrayList();
<a name="l00118"></a>00118     <span class="keyword">protected</span> CopyOnWriteArrayList m_painters;
<a name="l00119"></a>00119     <span class="keyword">protected</span> CopyOnWriteArrayList m_bounders;
<a name="l00120"></a>00120     
<a name="l00121"></a>00121     <span class="comment">// display</span>
<a name="l00122"></a>00122     <span class="keyword">protected</span> BufferedImage m_offscreen;
<a name="l00123"></a>00123     <span class="keyword">protected</span> Clip          m_clip = <span class="keyword">new</span> Clip();
<a name="l00124"></a>00124     <span class="keyword">protected</span> Clip          m_screen = <span class="keyword">new</span> Clip();
<a name="l00125"></a>00125     <span class="keyword">protected</span> Clip          m_bounds = <span class="keyword">new</span> Clip();
<a name="l00126"></a>00126     <span class="keyword">protected</span> Rectangle2D   m_rclip = <span class="keyword">new</span> Rectangle2D.Double();
<a name="l00127"></a>00127     <span class="keyword">protected</span> <span class="keywordtype">boolean</span>       m_damageRedraw = <span class="keyword">true</span>;
<a name="l00128"></a>00128     <span class="keyword">protected</span> <span class="keywordtype">boolean</span>       m_highQuality = <span class="keyword">false</span>;
<a name="l00129"></a>00129     
<a name="l00130"></a>00130     <span class="comment">// optional background image</span>
<a name="l00131"></a>00131     <span class="keyword">protected</span> BackgroundPainter m_bgpainter = null;
<a name="l00132"></a>00132     
<a name="l00133"></a>00133     <span class="comment">// rendering queue</span>
<a name="l00134"></a>00134     <span class="keyword">protected</span> RenderingQueue m_queue = <span class="keyword">new</span> RenderingQueue();
<a name="l00135"></a>00135     <span class="keyword">protected</span> <span class="keywordtype">int</span>            m_visibleCount = 0;
<a name="l00136"></a>00136     
<a name="l00137"></a>00137     <span class="comment">// transform variables</span>
<a name="l00138"></a>00138     <span class="keyword">protected</span> AffineTransform   m_transform  = <span class="keyword">new</span> AffineTransform();
<a name="l00139"></a>00139     <span class="keyword">protected</span> AffineTransform   m_itransform = <span class="keyword">new</span> AffineTransform();
<a name="l00140"></a>00140     <span class="keyword">protected</span> TransformActivity m_transact;
<a name="l00141"></a>00141     <span class="keyword">protected</span> Point2D m_tmpPoint = <span class="keyword">new</span> Point2D.Double();
<a name="l00142"></a>00142     
<a name="l00143"></a>00143     <span class="comment">// frame count and debugging output</span>
<a name="l00144"></a>00144     <span class="keyword">protected</span> <span class="keywordtype">double</span> frameRate;
<a name="l00145"></a>00145     <span class="keyword">protected</span> <span class="keywordtype">int</span> nframes = 0;
<a name="l00146"></a>00146     <span class="keyword">private</span> <span class="keywordtype">int</span> sampleInterval = 10;
<a name="l00147"></a>00147     <span class="keyword">private</span> <span class="keywordtype">long</span> mark = -1L;
<a name="l00148"></a>00148     
<a name="l00149"></a>00149     <span class="comment">/* Custom tooltip, null to use regular tooltip mechanisms */</span>
<a name="l00150"></a>00150     <span class="keyword">protected</span> JToolTip m_customToolTip = null;
<a name="l00151"></a>00151     
<a name="l00152"></a>00152     <span class="comment">// text editing variables</span>
<a name="l00153"></a>00153     <span class="keyword">private</span> JTextComponent m_editor;
<a name="l00154"></a>00154     <span class="keyword">private</span> <span class="keywordtype">boolean</span>        m_editing;
<a name="l00155"></a>00155     <span class="keyword">private</span> VisualItem     m_editItem;
<a name="l00156"></a>00156     <span class="keyword">private</span> String         m_editAttribute;
<a name="l00157"></a>00157     
<a name="l00162"></a>00162     <span class="comment">//public Display() {</span>
<a name="l00163"></a>00163     <span class="comment">//    this(null);        </span>
<a name="l00164"></a>00164     <span class="comment">//}</span>
<a name="l00165"></a>00165     
<a name="l00172"></a><a class="code" href="classprefuse_1_1_display.html#ad424364a88e9886cd1483958035fb890">00172</a>     <span class="keyword">public</span> <a class="code" href="classprefuse_1_1_display.html#ad424364a88e9886cd1483958035fb890">Display</a>(<a class="code" href="classprefuse_1_1_visualization.html">Visualization</a> visualization) {
<a name="l00173"></a>00173         <span class="keyword">this</span>(visualization, (Predicate)null);
<a name="l00174"></a>00174     }
<a name="l00175"></a>00175     
<a name="l00187"></a><a class="code" href="classprefuse_1_1_display.html#aae0df9b41845b2342b8bfe872249b784">00187</a>     <span class="keyword">public</span> <a class="code" href="classprefuse_1_1_display.html#aae0df9b41845b2342b8bfe872249b784">Display</a>(<a class="code" href="classprefuse_1_1_visualization.html">Visualization</a> visualization, String predicate) {
<a name="l00188"></a>00188         <span class="keyword">this</span>(visualization,
<a name="l00189"></a>00189                 (Predicate)ExpressionParser.parse(predicate, <span class="keyword">true</span>));
<a name="l00190"></a>00190     }
<a name="l00191"></a>00191     
<a name="l00199"></a><a class="code" href="classprefuse_1_1_display.html#a1f7ed47dd3ff247553d443bbb5cb443e">00199</a>     <span class="keyword">public</span> <a class="code" href="classprefuse_1_1_display.html#a1f7ed47dd3ff247553d443bbb5cb443e">Display</a>(<a class="code" href="classprefuse_1_1_visualization.html">Visualization</a> visualization, Predicate predicate) {
<a name="l00200"></a>00200         setDoubleBuffered(<span class="keyword">false</span>);
<a name="l00201"></a>00201         setBackground(Color.WHITE);
<a name="l00202"></a>00202         
<a name="l00203"></a>00203         <span class="comment">// initialize text editor</span>
<a name="l00204"></a>00204         m_editing = <span class="keyword">false</span>;
<a name="l00205"></a>00205         m_editor = <span class="keyword">new</span> JTextField();
<a name="l00206"></a>00206         m_editor.setBorder(null);
<a name="l00207"></a>00207         m_editor.setVisible(<span class="keyword">false</span>);
<a name="l00208"></a>00208         this.add(m_editor);
<a name="l00209"></a>00209         
<a name="l00210"></a>00210         <span class="comment">// register input event capturer</span>
<a name="l00211"></a>00211         <a class="code" href="classprefuse_1_1_display_1_1_input_event_capturer.html">InputEventCapturer</a> iec = <span class="keyword">new</span> <a class="code" href="classprefuse_1_1_display_1_1_input_event_capturer.html">InputEventCapturer</a>();
<a name="l00212"></a>00212         addMouseListener(iec);
<a name="l00213"></a>00213         addMouseMotionListener(iec);
<a name="l00214"></a>00214         addMouseWheelListener(iec);
<a name="l00215"></a>00215         addKeyListener(iec);
<a name="l00216"></a>00216         
<a name="l00217"></a>00217         registerDefaultCommands();
<a name="l00218"></a>00218         
<a name="l00219"></a>00219         <span class="comment">// invalidate the display when the filter changes</span>
<a name="l00220"></a>00220         m_predicate.addExpressionListener(<span class="keyword">new</span> UpdateListener() {
<a name="l00221"></a>00221             <span class="keyword">public</span> <span class="keywordtype">void</span> update(Object src) { damageReport(); }
<a name="l00222"></a>00222         });
<a name="l00223"></a>00223         
<a name="l00224"></a>00224         setVisualization(visualization);
<a name="l00225"></a>00225         setPredicate(predicate);
<a name="l00226"></a>00226         setSize(400,400); <span class="comment">// set a default size</span>
<a name="l00227"></a>00227         
<a name="l00228"></a>00228         m_transact = <span class="keyword">new</span> TransformActivity(getVisualization());
<a name="l00229"></a>00229     }
<a name="l00230"></a>00230     
<a name="l00236"></a><a class="code" href="classprefuse_1_1_display.html#a91f764a0d273666d127405bfafff3abd">00236</a>     <span class="keyword">public</span> <span class="keywordtype">void</span> <a class="code" href="classprefuse_1_1_display.html#a91f764a0d273666d127405bfafff3abd">reset</a>() {
<a name="l00237"></a>00237         m_offscreen = null;
<a name="l00238"></a>00238         m_queue.clean();
<a name="l00239"></a>00239     }
<a name="l00240"></a>00240     
<a name="l00251"></a><a class="code" href="classprefuse_1_1_display.html#a950d69b407851d27e6bd77bb5e8fca10">00251</a>     <span class="keyword">protected</span> <span class="keywordtype">void</span> <a class="code" href="classprefuse_1_1_display.html#a950d69b407851d27e6bd77bb5e8fca10">registerDefaultCommands</a>() {
<a name="l00252"></a>00252         <span class="comment">// add debugging output control</span>
<a name="l00253"></a>00253         registerKeyboardAction(<span class="keyword">new</span> ActionListener() {
<a name="l00254"></a>00254             <span class="keyword">private</span> PaintListener m_debug = null;
<a name="l00255"></a>00255 
<a name="l00256"></a>00256             <span class="keyword">public</span> <span class="keywordtype">void</span> actionPerformed(ActionEvent e) {
<a name="l00257"></a>00257                 <span class="keywordflow">if</span> (m_debug == null) {
<a name="l00258"></a>00258                     m_debug = <span class="keyword">new</span> DebugStatsPainter();
<a name="l00259"></a>00259                     addPaintListener(m_debug);
<a name="l00260"></a>00260                 } <span class="keywordflow">else</span> {
<a name="l00261"></a>00261                     removePaintListener(m_debug);
<a name="l00262"></a>00262                     m_debug = null;
<a name="l00263"></a>00263                 }
<a name="l00264"></a>00264                 repaint();
<a name="l00265"></a>00265             }
<a name="l00266"></a>00266         }, <span class="stringliteral">&quot;debug info&quot;</span>, KeyStroke.getKeyStroke(<span class="stringliteral">&quot;ctrl D&quot;</span>), WHEN_FOCUSED);
<a name="l00267"></a>00267         
<a name="l00268"></a>00268         <span class="comment">// add quality toggle</span>
<a name="l00269"></a>00269         registerKeyboardAction(<span class="keyword">new</span> ActionListener() {
<a name="l00270"></a>00270             <span class="keyword">public</span> <span class="keywordtype">void</span> actionPerformed(ActionEvent e) {
<a name="l00271"></a>00271                 setHighQuality(!isHighQuality());
<a name="l00272"></a>00272                 repaint();
<a name="l00273"></a>00273             }
<a name="l00274"></a>00274         }, <span class="stringliteral">&quot;toggle high-quality drawing&quot;</span>, KeyStroke.getKeyStroke(<span class="stringliteral">&quot;ctrl H&quot;</span>),
<a name="l00275"></a>00275                 WHEN_FOCUSED);
<a name="l00276"></a>00276         
<a name="l00277"></a>00277         <span class="comment">// add image output control, if this is not an applet</span>
<a name="l00278"></a>00278         <span class="keywordflow">try</span> {
<a name="l00279"></a>00279             registerKeyboardAction(<span class="keyword">new</span> ExportDisplayAction(<span class="keyword">this</span>),
<a name="l00280"></a>00280              <span class="stringliteral">&quot;export display&quot;</span>, KeyStroke.getKeyStroke(<span class="stringliteral">&quot;ctrl E&quot;</span>), WHEN_FOCUSED);
<a name="l00281"></a>00281         } <span class="keywordflow">catch</span> (SecurityException se) {
<a name="l00282"></a>00282         }
<a name="l00283"></a>00283     }
<a name="l00284"></a>00284     
<a name="l00291"></a><a class="code" href="classprefuse_1_1_display.html#aae49785b6562c001901b154feb2a512d">00291</a>     <span class="keyword">public</span> <span class="keywordtype">void</span> <a class="code" href="classprefuse_1_1_display.html#aae49785b6562c001901b154feb2a512d">setSize</a>(<span class="keywordtype">int</span> width, <span class="keywordtype">int</span> height) {
<a name="l00292"></a>00292         m_offscreen = null;
<a name="l00293"></a>00293         setPreferredSize(<span class="keyword">new</span> Dimension(width, height));
<a name="l00294"></a>00294         super.setSize(width, height);
<a name="l00295"></a>00295     }
<a name="l00296"></a>00296     
<a name="l00302"></a><a class="code" href="classprefuse_1_1_display.html#a79a20d2bb347ef95ab3655605675aeac">00302</a>     <span class="keyword">public</span> <span class="keywordtype">void</span> <a class="code" href="classprefuse_1_1_display.html#a79a20d2bb347ef95ab3655605675aeac">setSize</a>(Dimension d) {
<a name="l00303"></a>00303         m_offscreen = null;
<a name="l00304"></a>00304         setPreferredSize(d);
<a name="l00305"></a>00305         super.setSize(d);
<a name="l00306"></a>00306     }
<a name="l00307"></a>00307 
<a name="l00313"></a><a class="code" href="classprefuse_1_1_display.html#a271a7aa495f913838a6ad3cbdac37dbd">00313</a>     <span class="keyword">public</span> <span class="keywordtype">void</span> <a class="code" href="classprefuse_1_1_display.html#a271a7aa495f913838a6ad3cbdac37dbd">invalidate</a>() {
<a name="l00314"></a>00314         damageReport();
<a name="l00315"></a>00315         super.invalidate();
<a name="l00316"></a>00316     }
<a name="l00317"></a>00317     
<a name="l00321"></a><a class="code" href="classprefuse_1_1_display.html#ad39eb10bcc5655c1d1d688b4ecb85f8c">00321</a>     <span class="keyword">public</span> <span class="keywordtype">void</span> <a class="code" href="classprefuse_1_1_display.html#ad39eb10bcc5655c1d1d688b4ecb85f8c">setBounds</a>(<span class="keywordtype">int</span> x, <span class="keywordtype">int</span> y, <span class="keywordtype">int</span> w, <span class="keywordtype">int</span> h) {
<a name="l00322"></a>00322         m_offscreen = null;
<a name="l00323"></a>00323         super.setBounds(x,y,w,h);
<a name="l00324"></a>00324     }
<a name="l00325"></a>00325     
<a name="l00331"></a><a class="code" href="classprefuse_1_1_display.html#acff42d70280bee8d15453b0fbb022ae3">00331</a>     <span class="keyword">public</span> <span class="keywordtype">void</span> <a class="code" href="classprefuse_1_1_display.html#acff42d70280bee8d15453b0fbb022ae3">setFont</a>(Font f) {
<a name="l00332"></a>00332         super.setFont(f);
<a name="l00333"></a>00333         m_editor.setFont(f);
<a name="l00334"></a>00334     }
<a name="l00335"></a>00335     
<a name="l00340"></a><a class="code" href="classprefuse_1_1_display.html#a66b764755d5d6f7150884408f0095dfc">00340</a>     <span class="keyword">public</span> <span class="keywordtype">double</span> <a class="code" href="classprefuse_1_1_display.html#a66b764755d5d6f7150884408f0095dfc">getFrameRate</a>() {
<a name="l00341"></a>00341         <span class="keywordflow">return</span> frameRate;
<a name="l00342"></a>00342     }
<a name="l00343"></a>00343     
<a name="l00350"></a><a class="code" href="classprefuse_1_1_display.html#a8221733df785dee4e6c0d1b4ede034e2">00350</a>     <span class="keyword">public</span> <span class="keywordtype">void</span> <a class="code" href="classprefuse_1_1_display.html#a8221733df785dee4e6c0d1b4ede034e2">setHighQuality</a>(<span class="keywordtype">boolean</span> on) {
<a name="l00351"></a>00351         <span class="keywordflow">if</span> ( m_highQuality != on )
<a name="l00352"></a>00352             damageReport();
<a name="l00353"></a>00353         m_highQuality = on;
<a name="l00354"></a>00354     }
<a name="l00355"></a>00355     
<a name="l00361"></a><a class="code" href="classprefuse_1_1_display.html#a992dd7e2345ea710d91f620b31ff7101">00361</a>     <span class="keyword">public</span> <span class="keywordtype">boolean</span> <a class="code" href="classprefuse_1_1_display.html#a992dd7e2345ea710d91f620b31ff7101">isHighQuality</a>() {
<a name="l00362"></a>00362         <span class="keywordflow">return</span> m_highQuality;
<a name="l00363"></a>00363     }
<a name="l00364"></a>00364     
<a name="l00369"></a><a class="code" href="classprefuse_1_1_display.html#a1854817b565a45a48e759054a7e65f04">00369</a>     <span class="keyword">public</span> <a class="code" href="classprefuse_1_1_visualization.html">Visualization</a> <a class="code" href="classprefuse_1_1_display.html#a1854817b565a45a48e759054a7e65f04">getVisualization</a>() {
<a name="l00370"></a>00370         <span class="keywordflow">return</span> m_vis;
<a name="l00371"></a>00371     }
<a name="l00372"></a>00372     
<a name="l00380"></a><a class="code" href="classprefuse_1_1_display.html#adbe30cf6361872089b006128c5769609">00380</a>     <span class="keyword">public</span> <span class="keywordtype">void</span> <a class="code" href="classprefuse_1_1_display.html#adbe30cf6361872089b006128c5769609">setVisualization</a>(<a class="code" href="classprefuse_1_1_visualization.html">Visualization</a> vis) {
<a name="l00381"></a>00381         <span class="comment">// TODO: synchronization?</span>
<a name="l00382"></a>00382         <span class="keywordflow">if</span> ( m_vis == vis ) {
<a name="l00383"></a>00383             <span class="comment">// nothing need be done</span>
<a name="l00384"></a>00384             <span class="keywordflow">return</span>;
<a name="l00385"></a>00385         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( m_vis != null ) {
<a name="l00386"></a>00386             <span class="comment">// remove this display from it&#39;s previous registry</span>
<a name="l00387"></a>00387             m_vis.<a class="code" href="classprefuse_1_1_visualization.html#a838a4fd91210b98183a42bafb1608f89">removeDisplay</a>(<span class="keyword">this</span>);
<a name="l00388"></a>00388         }
<a name="l00389"></a>00389         m_vis = vis;
<a name="l00390"></a>00390         <span class="keywordflow">if</span> ( m_vis != null )
<a name="l00391"></a>00391             m_vis.<a class="code" href="classprefuse_1_1_visualization.html#a750273588214ad6980535438a3086f64">addDisplay</a>(<span class="keyword">this</span>);
<a name="l00392"></a>00392     }
<a name="l00393"></a>00393     
<a name="l00399"></a><a class="code" href="classprefuse_1_1_display.html#a9ba3eb2fb69ccc5d3bf009593cf8bdff">00399</a>     <span class="keyword">public</span> Predicate <a class="code" href="classprefuse_1_1_display.html#a9ba3eb2fb69ccc5d3bf009593cf8bdff">getPredicate</a>() {
<a name="l00400"></a>00400         <span class="keywordflow">if</span> ( m_predicate.size() == 1 ) {
<a name="l00401"></a>00401             <span class="keywordflow">return</span> BooleanLiteral.TRUE;
<a name="l00402"></a>00402         } <span class="keywordflow">else</span> {
<a name="l00403"></a>00403             <span class="keywordflow">return</span> m_predicate.get(0);
<a name="l00404"></a>00404         }
<a name="l00405"></a>00405     }
<a name="l00406"></a>00406 
<a name="l00416"></a><a class="code" href="classprefuse_1_1_display.html#a629fe14c2397dbca9412ca15b809fda0">00416</a>     <span class="keyword">public</span> <span class="keywordtype">void</span> <a class="code" href="classprefuse_1_1_display.html#a629fe14c2397dbca9412ca15b809fda0">setPredicate</a>(String expr) {
<a name="l00417"></a>00417         Predicate p = (Predicate)ExpressionParser.parse(expr, <span class="keyword">true</span>);
<a name="l00418"></a>00418         setPredicate(p);
<a name="l00419"></a>00419     }
<a name="l00420"></a>00420     
<a name="l00426"></a><a class="code" href="classprefuse_1_1_display.html#abdf5a4be29ad618d9f1e64646e9a7181">00426</a>     <span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keywordtype">void</span> <a class="code" href="classprefuse_1_1_display.html#abdf5a4be29ad618d9f1e64646e9a7181">setPredicate</a>(Predicate p) {
<a name="l00427"></a>00427         <span class="keywordflow">if</span> ( p == null ) {
<a name="l00428"></a>00428             m_predicate.set(VisiblePredicate.TRUE);
<a name="l00429"></a>00429         } <span class="keywordflow">else</span> {
<a name="l00430"></a>00430             m_predicate.set(<span class="keyword">new</span> Predicate[] {p, VisiblePredicate.TRUE});
<a name="l00431"></a>00431         }
<a name="l00432"></a>00432     }
<a name="l00433"></a>00433     
<a name="l00440"></a><a class="code" href="classprefuse_1_1_display.html#a80b39f22b19a92df064cf8fb1a8385bb">00440</a>     <span class="keyword">public</span> <span class="keywordtype">int</span> <a class="code" href="classprefuse_1_1_display.html#a80b39f22b19a92df064cf8fb1a8385bb">getVisibleItemCount</a>() {
<a name="l00441"></a>00441         <span class="keywordflow">return</span> m_visibleCount;
<a name="l00442"></a>00442     }
<a name="l00443"></a>00443     
<a name="l00450"></a><a class="code" href="classprefuse_1_1_display.html#a4cb1cd06dd0703a7f4153cadd2a03d64">00450</a>     <span class="keyword">public</span> ItemSorter <a class="code" href="classprefuse_1_1_display.html#a4cb1cd06dd0703a7f4153cadd2a03d64">getItemSorter</a>() {
<a name="l00451"></a>00451         <span class="keywordflow">return</span> m_queue.sort;
<a name="l00452"></a>00452     }
<a name="l00453"></a>00453 
<a name="l00460"></a><a class="code" href="classprefuse_1_1_display.html#a469fa13cefdade65fa7d18dd230bf6cd">00460</a>     <span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keywordtype">void</span> <a class="code" href="classprefuse_1_1_display.html#a469fa13cefdade65fa7d18dd230bf6cd">setItemSorter</a>(ItemSorter cmp) {
<a name="l00461"></a>00461         damageReport();
<a name="l00462"></a>00462         m_queue.sort = cmp;
<a name="l00463"></a>00463     }
<a name="l00464"></a>00464     
<a name="l00465"></a>00465 
<a name="l00476"></a><a class="code" href="classprefuse_1_1_display.html#a1af90a93a6a5a8683d8f1693094c22b1">00476</a>     <span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keywordtype">void</span> setBackgroundImage(Image image,
<a name="l00477"></a>00477                                       <span class="keywordtype">boolean</span> fixed, <span class="keywordtype">boolean</span> tileImage)
<a name="l00478"></a>00478     {
<a name="l00479"></a>00479         BackgroundPainter bg = null;
<a name="l00480"></a>00480         <span class="keywordflow">if</span> ( image != null )
<a name="l00481"></a>00481             bg = <span class="keyword">new</span> BackgroundPainter(image, fixed, tileImage);
<a name="l00482"></a>00482         setBackgroundPainter(bg);
<a name="l00483"></a>00483     }
<a name="l00484"></a>00484 
<a name="l00498"></a><a class="code" href="classprefuse_1_1_display.html#ac29e64f10019c999f08d8eabd84f39d6">00498</a>     <span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keywordtype">void</span> setBackgroundImage(String location,
<a name="l00499"></a>00499                                       <span class="keywordtype">boolean</span> fixed, <span class="keywordtype">boolean</span> tileImage)
<a name="l00500"></a>00500     {
<a name="l00501"></a>00501         BackgroundPainter bg = null;
<a name="l00502"></a>00502         <span class="keywordflow">if</span> ( location != null )
<a name="l00503"></a>00503             bg = <span class="keyword">new</span> BackgroundPainter(location, fixed, tileImage);
<a name="l00504"></a>00504         setBackgroundPainter(bg);        
<a name="l00505"></a>00505     }
<a name="l00506"></a>00506     
<a name="l00507"></a>00507     <span class="keyword">private</span> <span class="keywordtype">void</span> setBackgroundPainter(BackgroundPainter bg) {
<a name="l00508"></a>00508         <span class="keywordflow">if</span> ( m_bgpainter != null )
<a name="l00509"></a>00509             removePaintListener(m_bgpainter);
<a name="l00510"></a>00510         m_bgpainter = bg;
<a name="l00511"></a>00511         <span class="keywordflow">if</span> ( bg != null )
<a name="l00512"></a>00512             addPaintListener(bg);
<a name="l00513"></a>00513     }
<a name="l00514"></a>00514     
<a name="l00515"></a>00515     <span class="comment">// ------------------------------------------------------------------------</span>
<a name="l00516"></a>00516     <span class="comment">// ToolTips</span>
<a name="l00517"></a>00517 
<a name="l00526"></a><a class="code" href="classprefuse_1_1_display.html#aa00f46683d87ee0ce22a5b783ab03aee">00526</a>     <span class="keyword">public</span> JToolTip <a class="code" href="classprefuse_1_1_display.html#aa00f46683d87ee0ce22a5b783ab03aee">createToolTip</a>() {
<a name="l00527"></a>00527         <span class="keywordflow">if</span> ( m_customToolTip == null ) {
<a name="l00528"></a>00528             <span class="keywordflow">return</span> super.createToolTip();
<a name="l00529"></a>00529         } <span class="keywordflow">else</span> {
<a name="l00530"></a>00530             <span class="keywordflow">return</span> m_customToolTip;
<a name="l00531"></a>00531         }
<a name="l00532"></a>00532     }
<a name="l00533"></a>00533     
<a name="l00546"></a><a class="code" href="classprefuse_1_1_display.html#ad919e832cc58bdf364f9721a61a903a7">00546</a>     <span class="keyword">public</span> <span class="keywordtype">void</span> <a class="code" href="classprefuse_1_1_display.html#ad919e832cc58bdf364f9721a61a903a7">setCustomToolTip</a>(JToolTip tooltip) {
<a name="l00547"></a>00547         m_customToolTip = tooltip;
<a name="l00548"></a>00548     }
<a name="l00549"></a>00549     
<a name="l00555"></a><a class="code" href="classprefuse_1_1_display.html#a6b1eb584ffdd6dd0922d2a7f7f6ab5be">00555</a>     <span class="keyword">public</span> JToolTip <a class="code" href="classprefuse_1_1_display.html#a6b1eb584ffdd6dd0922d2a7f7f6ab5be">getCustomToolTip</a>() {
<a name="l00556"></a>00556         <span class="keywordflow">return</span> m_customToolTip;
<a name="l00557"></a>00557     }
<a name="l00558"></a>00558     
<a name="l00559"></a>00559     <span class="comment">// ------------------------------------------------------------------------</span>
<a name="l00560"></a>00560     <span class="comment">// Clip / Bounds Management</span>
<a name="l00561"></a>00561     
<a name="l00581"></a><a class="code" href="classprefuse_1_1_display.html#ac01a0c5547a5f13e804bc4f2c7358aff">00581</a>     <span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keywordtype">boolean</span> <a class="code" href="classprefuse_1_1_display.html#ac01a0c5547a5f13e804bc4f2c7358aff">isDamageRedraw</a>() {
<a name="l00582"></a>00582         <span class="keywordflow">return</span> m_damageRedraw;
<a name="l00583"></a>00583     }
<a name="l00584"></a>00584     
<a name="l00604"></a><a class="code" href="classprefuse_1_1_display.html#a3b013d2c150dc5ba8e237e05f569f8ba">00604</a>     <span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keywordtype">void</span> <a class="code" href="classprefuse_1_1_display.html#a3b013d2c150dc5ba8e237e05f569f8ba">setDamageRedraw</a>(<span class="keywordtype">boolean</span> b) {
<a name="l00605"></a>00605         m_damageRedraw = b;
<a name="l00606"></a>00606         m_clip.invalidate();
<a name="l00607"></a>00607     }
<a name="l00608"></a>00608     
<a name="l00613"></a><a class="code" href="classprefuse_1_1_display.html#a982d9f77c30d4956c86e9ddc2410214a">00613</a>     <span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keywordtype">void</span> <a class="code" href="classprefuse_1_1_display.html#a982d9f77c30d4956c86e9ddc2410214a">damageReport</a>(Rectangle2D region) {
<a name="l00614"></a>00614         <span class="keywordflow">if</span> ( m_damageRedraw )
<a name="l00615"></a>00615             m_clip.union(region);
<a name="l00616"></a>00616     }
<a name="l00617"></a>00617     
<a name="l00621"></a><a class="code" href="classprefuse_1_1_display.html#ac919d24b02a59ac63014e361eef0609f">00621</a>     <span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keywordtype">void</span> <a class="code" href="classprefuse_1_1_display.html#ac919d24b02a59ac63014e361eef0609f">damageReport</a>() {
<a name="l00622"></a>00622         m_clip.invalidate();
<a name="l00623"></a>00623     }
<a name="l00624"></a>00624    
<a name="l00631"></a><a class="code" href="classprefuse_1_1_display.html#a3211aa9393c93ebcfacccaa2e7629eb0">00631</a>     <span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keywordtype">void</span> <a class="code" href="classprefuse_1_1_display.html#a3211aa9393c93ebcfacccaa2e7629eb0">clearDamage</a>() {
<a name="l00632"></a>00632         <span class="keywordflow">if</span> ( m_damageRedraw )
<a name="l00633"></a>00633             m_clip.reset();
<a name="l00634"></a>00634     }
<a name="l00635"></a>00635     
<a name="l00643"></a><a class="code" href="classprefuse_1_1_display.html#ab2c74f52b16865c49185aca6f0def445">00643</a>     <span class="keyword">public</span> <span class="keyword">synchronized</span> Rectangle2D <a class="code" href="classprefuse_1_1_display.html#ab2c74f52b16865c49185aca6f0def445">getItemBounds</a>() {
<a name="l00644"></a>00644         <span class="keywordflow">return</span> getItemBounds(<span class="keyword">new</span> Rectangle2D.Double());
<a name="l00645"></a>00645     }
<a name="l00646"></a>00646 
<a name="l00653"></a><a class="code" href="classprefuse_1_1_display.html#ae2b6e52753a4c318c70bd56c1fde3b73">00653</a>     <span class="keyword">public</span> <span class="keyword">synchronized</span> Rectangle2D <a class="code" href="classprefuse_1_1_display.html#ae2b6e52753a4c318c70bd56c1fde3b73">getItemBounds</a>(Rectangle2D b) {
<a name="l00654"></a>00654         b.setFrameFromDiagonal(m_bounds.getMinX(), m_bounds.getMinY(),
<a name="l00655"></a>00655                                m_bounds.getMaxX(), m_bounds.getMaxY());
<a name="l00656"></a>00656         <span class="keywordflow">return</span> b;
<a name="l00657"></a>00657     }
<a name="l00658"></a>00658     
<a name="l00659"></a>00659     <span class="comment">// ------------------------------------------------------------------------</span>
<a name="l00660"></a>00660     <span class="comment">// Rendering</span>
<a name="l00661"></a>00661     
<a name="l00666"></a><a class="code" href="classprefuse_1_1_display.html#a00d50105e2d71f4d182dd9ec16f5a4aa">00666</a>     <span class="keyword">public</span> BufferedImage <a class="code" href="classprefuse_1_1_display.html#a00d50105e2d71f4d182dd9ec16f5a4aa">getOffscreenBuffer</a>() {
<a name="l00667"></a>00667         <span class="keywordflow">return</span> m_offscreen;
<a name="l00668"></a>00668     }
<a name="l00669"></a>00669     
<a name="l00673"></a><a class="code" href="classprefuse_1_1_display.html#a1677624718c346edc5ca3be5cc87c1f1">00673</a>     <span class="keyword">protected</span> BufferedImage <a class="code" href="classprefuse_1_1_display.html#a1677624718c346edc5ca3be5cc87c1f1">getNewOffscreenBuffer</a>(<span class="keywordtype">int</span> width, <span class="keywordtype">int</span> height) {
<a name="l00674"></a>00674         BufferedImage img = null;
<a name="l00675"></a>00675         <span class="keywordflow">if</span> ( !GraphicsEnvironment.isHeadless() ) {
<a name="l00676"></a>00676             <span class="keywordflow">try</span> {
<a name="l00677"></a>00677                 img = (BufferedImage)createImage(width, height);
<a name="l00678"></a>00678             } <span class="keywordflow">catch</span> ( Exception e ) {
<a name="l00679"></a>00679                 img = null;
<a name="l00680"></a>00680             }
<a name="l00681"></a>00681         }
<a name="l00682"></a>00682         <span class="keywordflow">if</span> ( img == null ) {
<a name="l00683"></a>00683             <span class="keywordflow">return</span> <span class="keyword">new</span> BufferedImage(width, height, BufferedImage.TYPE_INT_RGB);
<a name="l00684"></a>00684         }
<a name="l00685"></a>00685         <span class="keywordflow">return</span> img;
<a name="l00686"></a>00686     }
<a name="l00687"></a>00687     
<a name="l00699"></a><a class="code" href="classprefuse_1_1_display.html#a4e86a936b9d2869584f3e93ebdf7a28d">00699</a>     <span class="keyword">public</span> <span class="keywordtype">boolean</span> saveImage(OutputStream output, String format, <span class="keywordtype">double</span> scale)
<a name="l00700"></a>00700     {
<a name="l00701"></a>00701         <span class="keywordflow">try</span> {
<a name="l00702"></a>00702             <span class="comment">// get an image to draw into</span>
<a name="l00703"></a>00703             Dimension d = <span class="keyword">new</span> Dimension((<span class="keywordtype">int</span>)(scale*getWidth()),
<a name="l00704"></a>00704                                         (<span class="keywordtype">int</span>)(scale*getHeight()));
<a name="l00705"></a>00705             BufferedImage img = getNewOffscreenBuffer(d.width, d.height);
<a name="l00706"></a>00706             Graphics2D g = (Graphics2D)img.getGraphics();
<a name="l00707"></a>00707             
<a name="l00708"></a>00708             <span class="comment">// set up the display, render, then revert to normal settings</span>
<a name="l00709"></a>00709             Point2D p = <span class="keyword">new</span> Point2D.Double(0,0);
<a name="l00710"></a>00710             zoom(p, scale); <span class="comment">// also takes care of damage report</span>
<a name="l00711"></a>00711             <span class="keywordtype">boolean</span> q = isHighQuality();
<a name="l00712"></a>00712             setHighQuality(<span class="keyword">true</span>);
<a name="l00713"></a>00713             paintDisplay(g, d);
<a name="l00714"></a>00714             setHighQuality(q);
<a name="l00715"></a>00715             zoom(p, 1/scale); <span class="comment">// also takes care of damage report</span>
<a name="l00716"></a>00716             
<a name="l00717"></a>00717             <span class="comment">// save the image and return</span>
<a name="l00718"></a>00718             ImageIO.write(img, format, output);
<a name="l00719"></a>00719             <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00720"></a>00720         } <span class="keywordflow">catch</span> ( Exception e ) {
<a name="l00721"></a>00721             e.printStackTrace();
<a name="l00722"></a>00722             <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00723"></a>00723         }
<a name="l00724"></a>00724     }
<a name="l00725"></a>00725 
<a name="l00729"></a><a class="code" href="classprefuse_1_1_display.html#a3a09c2e0442e60fd36f3acfc45e1705b">00729</a>     <span class="keyword">public</span> <span class="keywordtype">void</span> <a class="code" href="classprefuse_1_1_display.html#a3a09c2e0442e60fd36f3acfc45e1705b">update</a>(Graphics g) {
<a name="l00730"></a>00730         paint(g);
<a name="l00731"></a>00731     }
<a name="l00732"></a>00732     
<a name="l00737"></a><a class="code" href="classprefuse_1_1_display.html#a97c62b448d5b3ab37a8d613251dd9a48">00737</a>     <span class="keyword">protected</span> <span class="keywordtype">void</span> <a class="code" href="classprefuse_1_1_display.html#a97c62b448d5b3ab37a8d613251dd9a48">paintBufferToScreen</a>(Graphics g) {
<a name="l00738"></a>00738         <span class="keyword">synchronized</span> ( this ) {
<a name="l00739"></a>00739             g.drawImage(m_offscreen, 0, 0, null);
<a name="l00740"></a>00740         }
<a name="l00741"></a>00741     }
<a name="l00742"></a>00742 
<a name="l00747"></a><a class="code" href="classprefuse_1_1_display.html#a5a904ad07f85220892844564f6f73ac2">00747</a>     <span class="keyword">public</span> <span class="keywordtype">void</span> <a class="code" href="classprefuse_1_1_display.html#a5a904ad07f85220892844564f6f73ac2">repaintImmediate</a>() {
<a name="l00748"></a>00748         Graphics g = this.getGraphics();
<a name="l00749"></a>00749         <span class="keywordflow">if</span> (g != null &amp;&amp; m_offscreen != null) {
<a name="l00750"></a>00750             paintBufferToScreen(g);
<a name="l00751"></a>00751         }
<a name="l00752"></a>00752     }
<a name="l00753"></a>00753 
<a name="l00759"></a><a class="code" href="classprefuse_1_1_display.html#aaaf7d0fa8eebd69d652d973d2c0a17ae">00759</a>     <span class="keyword">protected</span> <span class="keywordtype">void</span> <a class="code" href="classprefuse_1_1_display.html#aaaf7d0fa8eebd69d652d973d2c0a17ae">prepareGraphics</a>(Graphics2D g) {
<a name="l00760"></a>00760         <span class="keywordflow">if</span> ( m_transform != null )
<a name="l00761"></a>00761             g.transform(m_transform);
<a name="l00762"></a>00762         setRenderingHints(g);
<a name="l00763"></a>00763     }
<a name="l00764"></a>00764     
<a name="l00772"></a><a class="code" href="classprefuse_1_1_display.html#a3b093cbb40cf072bf84b6b89f7ab85f0">00772</a>     <span class="keyword">protected</span> <span class="keywordtype">void</span> <a class="code" href="classprefuse_1_1_display.html#a3b093cbb40cf072bf84b6b89f7ab85f0">setRenderingHints</a>(Graphics2D g) {
<a name="l00773"></a>00773         <span class="keywordflow">if</span> ( m_highQuality ) {
<a name="l00774"></a>00774             g.setRenderingHint(RenderingHints.KEY_ANTIALIASING,
<a name="l00775"></a>00775                     RenderingHints.VALUE_ANTIALIAS_ON);
<a name="l00776"></a>00776         } <span class="keywordflow">else</span> {
<a name="l00777"></a>00777             g.setRenderingHint(RenderingHints.KEY_ANTIALIASING,
<a name="l00778"></a>00778                     RenderingHints.VALUE_ANTIALIAS_OFF);
<a name="l00779"></a>00779         }
<a name="l00780"></a>00780         g.setRenderingHint(
<a name="l00781"></a>00781             RenderingHints.KEY_RENDERING,
<a name="l00782"></a>00782             RenderingHints.VALUE_RENDER_QUALITY);
<a name="l00783"></a>00783         g.setRenderingHint(
<a name="l00784"></a>00784             RenderingHints.KEY_INTERPOLATION,
<a name="l00785"></a>00785             RenderingHints.VALUE_INTERPOLATION_BICUBIC);
<a name="l00786"></a>00786     }
<a name="l00787"></a>00787 
<a name="l00788"></a>00788 
<a name="l00792"></a><a class="code" href="classprefuse_1_1_display.html#a02d52d9a40bcab537256716076de706b">00792</a>     <span class="keyword">public</span> Graphics2D <a class="code" href="classprefuse_1_1_display.html#a02d52d9a40bcab537256716076de706b">graphics</a>;
<a name="l00793"></a>00793     <span class="keyword">public</span> <span class="keywordtype">void</span> paintComponent(Graphics g) {
<a name="l00794"></a>00794         <span class="keywordflow">if</span> (m_offscreen == null) {
<a name="l00795"></a>00795             m_offscreen = getNewOffscreenBuffer(getWidth(), getHeight());
<a name="l00796"></a>00796             damageReport();
<a name="l00797"></a>00797         }
<a name="l00798"></a>00798         Graphics2D g2D = (Graphics2D)g;
<a name="l00799"></a>00799         graphics = g2D;
<a name="l00800"></a>00800         Graphics2D buf_g2D = (Graphics2D) m_offscreen.getGraphics();
<a name="l00801"></a>00801         
<a name="l00802"></a>00802         <span class="comment">// Why not fire a pre-paint event here?</span>
<a name="l00803"></a>00803         <span class="comment">// Pre-paint events are fired by the clearRegion method</span>
<a name="l00804"></a>00804         
<a name="l00805"></a>00805         <span class="comment">// paint the visualization</span>
<a name="l00806"></a>00806         paintDisplay(buf_g2D, getSize());
<a name="l00807"></a>00807         paintBufferToScreen(g2D);       
<a name="l00808"></a>00808         
<a name="l00809"></a>00809         <span class="comment">// fire post-paint events to any painters</span>
<a name="l00810"></a>00810         firePostPaint(g2D);
<a name="l00811"></a>00811         
<a name="l00812"></a>00812         buf_g2D.dispose();
<a name="l00813"></a>00813         
<a name="l00814"></a>00814         <span class="comment">// compute frame rate</span>
<a name="l00815"></a>00815         nframes++;
<a name="l00816"></a>00816         <span class="keywordflow">if</span> ( mark &lt; 0 ) {
<a name="l00817"></a>00817             mark = System.currentTimeMillis();
<a name="l00818"></a>00818             nframes = 0;
<a name="l00819"></a>00819         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( nframes == sampleInterval ){
<a name="l00820"></a>00820             <span class="keywordtype">long</span> t = System.currentTimeMillis();
<a name="l00821"></a>00821             frameRate = (1000.0*nframes)/(t-mark);
<a name="l00822"></a>00822             mark = t;
<a name="l00823"></a>00823             nframes = 0;
<a name="l00824"></a>00824         }
<a name="l00825"></a>00825     }
<a name="l00826"></a>00826     
<a name="l00832"></a><a class="code" href="classprefuse_1_1_display.html#a59ca67442b8f3c80fa3f463e7b669fd5">00832</a>     <span class="keyword">public</span> <span class="keywordtype">void</span> <a class="code" href="classprefuse_1_1_display.html#a59ca67442b8f3c80fa3f463e7b669fd5">paintDisplay</a>(Graphics2D g2D, Dimension d) {
<a name="l00833"></a>00833         <span class="comment">// if double-locking *ALWAYS* lock on the visualization first</span>
<a name="l00834"></a>00834         <span class="keyword">synchronized</span> ( m_vis ) {
<a name="l00835"></a>00835         <span class="keyword">synchronized</span> ( this ) {
<a name="l00836"></a>00836             
<a name="l00837"></a>00837             <span class="keywordflow">if</span> ( m_clip.isEmpty() )
<a name="l00838"></a>00838                 <span class="keywordflow">return</span>; <span class="comment">// no damage, no render</span>
<a name="l00839"></a>00839             
<a name="l00840"></a>00840             <span class="comment">// map the screen bounds to absolute coords</span>
<a name="l00841"></a>00841             m_screen.setClip(0, 0, d.width+1, d.height+1);
<a name="l00842"></a>00842             m_screen.transform(m_itransform);
<a name="l00843"></a>00843             
<a name="l00844"></a>00844             <span class="comment">// compute the approximate size of an &quot;absolute pixel&quot;</span>
<a name="l00845"></a>00845             <span class="comment">// values too large are OK (though cause unnecessary rendering)</span>
<a name="l00846"></a>00846             <span class="comment">// values too small will cause incorrect rendering</span>
<a name="l00847"></a>00847             <span class="keywordtype">double</span> pixel = 1.0 + 1.0/getScale();
<a name="l00848"></a>00848             
<a name="l00849"></a>00849             <span class="keywordflow">if</span> ( m_damageRedraw ) {  
<a name="l00850"></a>00850                 <span class="keywordflow">if</span> ( m_clip.isInvalid() ) {
<a name="l00851"></a>00851                     <span class="comment">// if clip is invalid, we clip to the entire screen</span>
<a name="l00852"></a>00852                     m_clip.setClip(m_screen);
<a name="l00853"></a>00853                 } <span class="keywordflow">else</span> {
<a name="l00854"></a>00854                     <span class="comment">// otherwise intersect damaged region with display bounds</span>
<a name="l00855"></a>00855                     m_clip.intersection(m_screen);
<a name="l00856"></a>00856                 }
<a name="l00857"></a>00857   
<a name="l00858"></a>00858                 <span class="comment">// expand the clip by the extra pixel margin</span>
<a name="l00859"></a>00859                 m_clip.expand(pixel);
<a name="l00860"></a>00860                 
<a name="l00861"></a>00861                 <span class="comment">// set the transform, rendering keys, etc</span>
<a name="l00862"></a>00862                 prepareGraphics(g2D);
<a name="l00863"></a>00863                 
<a name="l00864"></a>00864                 <span class="comment">// now set the actual rendering clip</span>
<a name="l00865"></a>00865                 m_rclip.setFrameFromDiagonal(
<a name="l00866"></a>00866                         m_clip.getMinX(), m_clip.getMinY(), 
<a name="l00867"></a>00867                         m_clip.getMaxX(), m_clip.getMaxY());
<a name="l00868"></a>00868                 g2D.setClip(m_rclip);
<a name="l00869"></a>00869                 
<a name="l00870"></a>00870                 <span class="comment">// finally, we want to clear the region we&#39;ll redraw. we clear</span>
<a name="l00871"></a>00871                 <span class="comment">// a slightly larger area than the clip. if we don&#39;t do this,</span>
<a name="l00872"></a>00872                 <span class="comment">// we sometimes get rendering artifacts, possibly due to</span>
<a name="l00873"></a>00873                 <span class="comment">// scaling mismatches in the Java2D implementation</span>
<a name="l00874"></a>00874                 m_rclip.setFrameFromDiagonal(
<a name="l00875"></a>00875                         m_clip.getMinX()-pixel, m_clip.getMinY()-pixel,
<a name="l00876"></a>00876                         m_clip.getMaxX()+pixel, m_clip.getMaxY()+pixel);
<a name="l00877"></a>00877 
<a name="l00878"></a>00878             } <span class="keywordflow">else</span> {
<a name="l00879"></a>00879                 <span class="comment">// set the background region to clear</span>
<a name="l00880"></a>00880                 m_rclip.setFrame(m_screen.getMinX(),  m_screen.getMinY(),
<a name="l00881"></a>00881                                  m_screen.getWidth(), m_screen.getHeight());
<a name="l00882"></a>00882                 
<a name="l00883"></a>00883                 <span class="comment">// set the item clip to the current screen</span>
<a name="l00884"></a>00884                 m_clip.setClip(m_screen);
<a name="l00885"></a>00885                 
<a name="l00886"></a>00886                 <span class="comment">// set the transform, rendering keys, etc</span>
<a name="l00887"></a>00887                 prepareGraphics(g2D);
<a name="l00888"></a>00888             }
<a name="l00889"></a>00889 
<a name="l00890"></a>00890             <span class="comment">// now clear the region</span>
<a name="l00891"></a>00891             clearRegion(g2D, m_rclip);            
<a name="l00892"></a>00892             
<a name="l00893"></a>00893             <span class="comment">// -- render ----------------------------</span>
<a name="l00894"></a>00894             <span class="comment">// the actual rendering  loop</span>
<a name="l00895"></a>00895             
<a name="l00896"></a>00896             <span class="comment">// copy current item bounds into m_rclip, reset item bounds</span>
<a name="l00897"></a>00897             getItemBounds(m_rclip);
<a name="l00898"></a>00898             m_bounds.reset();
<a name="l00899"></a>00899             
<a name="l00900"></a>00900             <span class="comment">// fill the rendering and picking queues</span>
<a name="l00901"></a>00901             m_queue.clear();   <span class="comment">// clear the queue</span>
<a name="l00902"></a>00902             Iterator&lt;?&gt; items = m_vis.<a class="code" href="classprefuse_1_1_visualization.html#a629a8a531883c3329d2cab70e8ad7e06">items</a>(m_predicate);
<a name="l00903"></a>00903             <span class="keywordflow">for</span> ( m_visibleCount=0; items.hasNext(); ++m_visibleCount ) {
<a name="l00904"></a>00904                 VisualItem item = (VisualItem)items.next();
<a name="l00905"></a>00905                 Rectangle2D bounds = item.getBounds();
<a name="l00906"></a>00906                 m_bounds.union(bounds); <span class="comment">// add to item bounds</span>
<a name="l00907"></a>00907                 
<a name="l00908"></a>00908                 <span class="keywordflow">if</span> ( m_clip.intersects(bounds, pixel) )
<a name="l00909"></a>00909                     m_queue.addToRenderQueue(item);
<a name="l00910"></a>00910                 <span class="keywordflow">if</span> ( item.isInteractive() )
<a name="l00911"></a>00911                     m_queue.addToPickingQueue(item);
<a name="l00912"></a>00912             }
<a name="l00913"></a>00913             
<a name="l00914"></a>00914             <span class="comment">// sort the rendering queue</span>
<a name="l00915"></a>00915             m_queue.sortRenderQueue();
<a name="l00916"></a>00916             
<a name="l00917"></a>00917             <span class="comment">// render each visual item</span>
<a name="l00918"></a>00918             <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> i=0; i&lt;m_queue.rsize; ++i ) {
<a name="l00919"></a>00919                 m_queue.ritems[i].render(g2D);
<a name="l00920"></a>00920             }
<a name="l00921"></a>00921             
<a name="l00922"></a>00922             <span class="comment">// no more damage so reset the clip</span>
<a name="l00923"></a>00923             <span class="keywordflow">if</span> ( m_damageRedraw )
<a name="l00924"></a>00924                 m_clip.reset();
<a name="l00925"></a>00925             
<a name="l00926"></a>00926             <span class="comment">// fire bounds change, if appropriate</span>
<a name="l00927"></a>00927             checkItemBoundsChanged(m_rclip);
<a name="l00928"></a>00928             
<a name="l00929"></a>00929         }} <span class="comment">// end synchronized block</span>
<a name="l00930"></a>00930     }
<a name="l00931"></a>00931     
<a name="l00937"></a><a class="code" href="classprefuse_1_1_display.html#a045cd78a5bd2acb207d4f72bfff51498">00937</a>     <span class="keyword">public</span> <span class="keywordtype">void</span> <a class="code" href="classprefuse_1_1_display.html#a045cd78a5bd2acb207d4f72bfff51498">renderImmediate</a>(VisualItem item) {
<a name="l00938"></a>00938         Graphics2D g2D = (Graphics2D)this.getGraphics();
<a name="l00939"></a>00939         prepareGraphics(g2D);
<a name="l00940"></a>00940         item.render(g2D);
<a name="l00941"></a>00941     }
<a name="l00942"></a>00942     
<a name="l00953"></a><a class="code" href="classprefuse_1_1_display.html#a327797805f6a5fd473a1218d148ccdca">00953</a>     <span class="keyword">protected</span> <span class="keywordtype">void</span> <a class="code" href="classprefuse_1_1_display.html#a327797805f6a5fd473a1218d148ccdca">printComponent</a>(Graphics g) {
<a name="l00954"></a>00954         <span class="keywordtype">boolean</span> wasHighQuality = m_highQuality;
<a name="l00955"></a>00955         <span class="keywordflow">try</span> {
<a name="l00956"></a>00956             <span class="comment">// Set the quality to high for the duration of the printing.</span>
<a name="l00957"></a>00957             m_highQuality = <span class="keyword">true</span>;
<a name="l00958"></a>00958             <span class="comment">// Paint directly to the print graphics context.</span>
<a name="l00959"></a>00959             paintDisplay((Graphics2D) g, getSize());
<a name="l00960"></a>00960         } <span class="keywordflow">finally</span> {
<a name="l00961"></a>00961             <span class="comment">// Reset the quality to the state it was in before printing.</span>
<a name="l00962"></a>00962             m_highQuality = wasHighQuality;
<a name="l00963"></a>00963         }
<a name="l00964"></a>00964     }
<a name="l00965"></a>00965     
<a name="l00970"></a><a class="code" href="classprefuse_1_1_display.html#aec81db01b0b291ce585e0adcb5ffec75">00970</a>     <span class="keyword">protected</span> <span class="keywordtype">void</span> <a class="code" href="classprefuse_1_1_display.html#aec81db01b0b291ce585e0adcb5ffec75">clearRegion</a>(Graphics2D g, Rectangle2D r) {
<a name="l00971"></a>00971         g.setColor(getBackground());
<a name="l00972"></a>00972         g.fill(r);
<a name="l00973"></a>00973         <span class="comment">// fire pre-paint events to any painters</span>
<a name="l00974"></a>00974         firePrePaint(g);
<a name="l00975"></a>00975     }
<a name="l00976"></a>00976 
<a name="l00977"></a>00977     <span class="comment">// ------------------------------------------------------------------------</span>
<a name="l00978"></a>00978     <span class="comment">// Transformations</span>
<a name="l00979"></a>00979     
<a name="l00987"></a><a class="code" href="classprefuse_1_1_display.html#ad66212a1b069f86248348dbd7b122dee">00987</a>     <span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keywordtype">void</span> setTransform(AffineTransform transform) 
<a name="l00988"></a>00988         <span class="keywordflow">throws</span> NoninvertibleTransformException
<a name="l00989"></a>00989     {
<a name="l00990"></a>00990         damageReport();
<a name="l00991"></a>00991         m_transform = transform;
<a name="l00992"></a>00992         m_itransform = m_transform.createInverse();
<a name="l00993"></a>00993     }
<a name="l00994"></a>00994     
<a name="l01001"></a><a class="code" href="classprefuse_1_1_display.html#a2895fa91162a982f12102215d0983d3f">01001</a>     <span class="keyword">public</span> AffineTransform <a class="code" href="classprefuse_1_1_display.html#a2895fa91162a982f12102215d0983d3f">getTransform</a>() {
<a name="l01002"></a>01002         <span class="keywordflow">return</span> m_transform;
<a name="l01003"></a>01003     }
<a name="l01004"></a>01004     
<a name="l01011"></a><a class="code" href="classprefuse_1_1_display.html#ac38422394b0dea923c477c8a9ebf4611">01011</a>     <span class="keyword">public</span> AffineTransform <a class="code" href="classprefuse_1_1_display.html#ac38422394b0dea923c477c8a9ebf4611">getInverseTransform</a>() {
<a name="l01012"></a>01012         <span class="keywordflow">return</span> m_itransform;
<a name="l01013"></a>01013     }
<a name="l01014"></a>01014     
<a name="l01025"></a><a class="code" href="classprefuse_1_1_display.html#a64f2fa148db1032b95604b747dfe02b8">01025</a>     <span class="keyword">public</span> Point2D <a class="code" href="classprefuse_1_1_display.html#a64f2fa148db1032b95604b747dfe02b8">getAbsoluteCoordinate</a>(Point2D screen, Point2D abs) {
<a name="l01026"></a>01026         <span class="keywordflow">return</span> m_itransform.transform(screen, abs);
<a name="l01027"></a>01027     }
<a name="l01028"></a>01028     
<a name="l01035"></a><a class="code" href="classprefuse_1_1_display.html#a74ccaf48b365862bf55acfb039e97bed">01035</a>     <span class="keyword">public</span> <span class="keywordtype">double</span> <a class="code" href="classprefuse_1_1_display.html#a74ccaf48b365862bf55acfb039e97bed">getScale</a>() {
<a name="l01036"></a>01036         <span class="keywordflow">return</span> m_transform.getScaleX();
<a name="l01037"></a>01037     }
<a name="l01038"></a>01038     
<a name="l01044"></a><a class="code" href="classprefuse_1_1_display.html#af8262cbf60292b5e61bc9a5b4d661ea0">01044</a>     <span class="keyword">public</span> <span class="keywordtype">double</span> <a class="code" href="classprefuse_1_1_display.html#af8262cbf60292b5e61bc9a5b4d661ea0">getDisplayX</a>() {
<a name="l01045"></a>01045         <span class="keywordflow">return</span> -m_transform.getTranslateX();
<a name="l01046"></a>01046     }
<a name="l01047"></a>01047     
<a name="l01053"></a><a class="code" href="classprefuse_1_1_display.html#ae5f1b89172bcfbf14cfc38295c2eea8d">01053</a>     <span class="keyword">public</span> <span class="keywordtype">double</span> <a class="code" href="classprefuse_1_1_display.html#ae5f1b89172bcfbf14cfc38295c2eea8d">getDisplayY</a>() {
<a name="l01054"></a>01054         <span class="keywordflow">return</span> -m_transform.getTranslateY();
<a name="l01055"></a>01055     }
<a name="l01056"></a>01056     
<a name="l01062"></a><a class="code" href="classprefuse_1_1_display.html#a065163ab976fc2b8c7884373af759895">01062</a>     <span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keywordtype">void</span> <a class="code" href="classprefuse_1_1_display.html#a065163ab976fc2b8c7884373af759895">pan</a>(<span class="keywordtype">double</span> dx, <span class="keywordtype">double</span> dy) {
<a name="l01063"></a>01063         m_tmpPoint.setLocation(dx, dy);
<a name="l01064"></a>01064         m_itransform.transform(m_tmpPoint, m_tmpPoint);
<a name="l01065"></a>01065         <span class="keywordtype">double</span> panx = m_tmpPoint.getX();
<a name="l01066"></a>01066         <span class="keywordtype">double</span> pany = m_tmpPoint.getY();
<a name="l01067"></a>01067         m_tmpPoint.setLocation(0, 0);
<a name="l01068"></a>01068         m_itransform.transform(m_tmpPoint, m_tmpPoint);
<a name="l01069"></a>01069         panx -= m_tmpPoint.getX();
<a name="l01070"></a>01070         pany -= m_tmpPoint.getY();
<a name="l01071"></a>01071         panAbs(panx, pany);
<a name="l01072"></a>01072 
<a name="l01073"></a>01073     }
<a name="l01074"></a>01074     
<a name="l01081"></a><a class="code" href="classprefuse_1_1_display.html#ae0b589ec47b4a1ca403d3f22112fd80d">01081</a>     <span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keywordtype">void</span> <a class="code" href="classprefuse_1_1_display.html#ae0b589ec47b4a1ca403d3f22112fd80d">panAbs</a>(<span class="keywordtype">double</span> dx, <span class="keywordtype">double</span> dy) {
<a name="l01082"></a>01082         damageReport();
<a name="l01083"></a>01083         m_transform.translate(dx, dy);
<a name="l01084"></a>01084         <span class="keywordflow">try</span> {
<a name="l01085"></a>01085             m_itransform = m_transform.createInverse();
<a name="l01086"></a>01086         } <span class="keywordflow">catch</span> ( Exception e ) { <span class="comment">/*will never happen here*/</span> }
<a name="l01087"></a>01087     }
<a name="l01088"></a>01088     
<a name="l01094"></a><a class="code" href="classprefuse_1_1_display.html#a375c9aa6e170b7219b96d290fdb69b6b">01094</a>     <span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keywordtype">void</span> <a class="code" href="classprefuse_1_1_display.html#a375c9aa6e170b7219b96d290fdb69b6b">panTo</a>(Point2D p) {
<a name="l01095"></a>01095         m_itransform.transform(p, m_tmpPoint);
<a name="l01096"></a>01096         panToAbs(m_tmpPoint);
<a name="l01097"></a>01097     }
<a name="l01098"></a>01098     
<a name="l01104"></a><a class="code" href="classprefuse_1_1_display.html#a6e488baa70b8daaca88094b87955ad4e">01104</a>     <span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keywordtype">void</span> <a class="code" href="classprefuse_1_1_display.html#a6e488baa70b8daaca88094b87955ad4e">panToAbs</a>(Point2D p) {
<a name="l01105"></a>01105         <span class="keywordtype">double</span> sx = m_transform.getScaleX();
<a name="l01106"></a>01106         <span class="keywordtype">double</span> sy = m_transform.getScaleY();
<a name="l01107"></a>01107         <span class="keywordtype">double</span> x = p.getX(); x = (Double.isNaN(x) ? 0 : x);
<a name="l01108"></a>01108         <span class="keywordtype">double</span> y = p.getY(); y = (Double.isNaN(y) ? 0 : y);
<a name="l01109"></a>01109         x = getWidth() /(2*sx) - x;
<a name="l01110"></a>01110         y = getHeight()/(2*sy) - y;
<a name="l01111"></a>01111         
<a name="l01112"></a>01112         <span class="keywordtype">double</span> dx = x-(m_transform.getTranslateX()/sx);
<a name="l01113"></a>01113         <span class="keywordtype">double</span> dy = y-(m_transform.getTranslateY()/sy);
<a name="l01114"></a>01114 
<a name="l01115"></a>01115         damageReport();
<a name="l01116"></a>01116         m_transform.translate(dx, dy);
<a name="l01117"></a>01117         <span class="keywordflow">try</span> {
<a name="l01118"></a>01118             m_itransform = m_transform.createInverse();
<a name="l01119"></a>01119         } <span class="keywordflow">catch</span> ( Exception e ) { <span class="comment">/*will never happen here*/</span> }
<a name="l01120"></a>01120     }
<a name="l01121"></a>01121 
<a name="l01128"></a><a class="code" href="classprefuse_1_1_display.html#ae395fe84a34715e6d5bd000ed3057872">01128</a>     <span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keywordtype">void</span> <a class="code" href="classprefuse_1_1_display.html#ae395fe84a34715e6d5bd000ed3057872">zoom</a>(<span class="keyword">final</span> Point2D p, <span class="keywordtype">double</span> scale) {
<a name="l01129"></a>01129         m_itransform.transform(p, m_tmpPoint);
<a name="l01130"></a>01130         zoomAbs(m_tmpPoint, scale);
<a name="l01131"></a>01131     }    
<a name="l01132"></a>01132     
<a name="l01140"></a><a class="code" href="classprefuse_1_1_display.html#afb21801d4eb7851cb1e12448da22297f">01140</a>     <span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keywordtype">void</span> <a class="code" href="classprefuse_1_1_display.html#afb21801d4eb7851cb1e12448da22297f">zoomAbs</a>(<span class="keyword">final</span> Point2D p, <span class="keywordtype">double</span> scale) {;
<a name="l01141"></a>01141         <span class="keywordtype">double</span> zx = p.getX(), zy = p.getY();
<a name="l01142"></a>01142         damageReport();
<a name="l01143"></a>01143         m_transform.translate(zx, zy);
<a name="l01144"></a>01144         m_transform.scale(scale,scale);
<a name="l01145"></a>01145         m_transform.translate(-zx, -zy);
<a name="l01146"></a>01146         <span class="keywordflow">try</span> {
<a name="l01147"></a>01147             m_itransform = m_transform.createInverse();
<a name="l01148"></a>01148         } <span class="keywordflow">catch</span> ( Exception e ) { <span class="comment">/*will never happen here*/</span> }
<a name="l01149"></a>01149     }
<a name="l01150"></a>01150     
<a name="l01151"></a>01151     <span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keywordtype">void</span> zoom(<span class="keywordtype">double</span> xScale, <span class="keywordtype">double</span> yScale) {
<a name="l01152"></a>01152         m_transform.scale(xScale,yScale);
<a name="l01153"></a>01153         <span class="keywordflow">try</span> {
<a name="l01154"></a>01154             m_itransform = m_transform.createInverse();
<a name="l01155"></a>01155         } <span class="keywordflow">catch</span> ( Exception e ) { <span class="comment">/*will never happen here*/</span> }
<a name="l01156"></a>01156     }
<a name="l01157"></a>01157     
<a name="l01164"></a><a class="code" href="classprefuse_1_1_display.html#a143af3170eb06733119635c889e84425">01164</a>     <span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keywordtype">void</span> <a class="code" href="classprefuse_1_1_display.html#a143af3170eb06733119635c889e84425">rotate</a>(<span class="keyword">final</span> Point2D p, <span class="keywordtype">double</span> theta) {
<a name="l01165"></a>01165         m_itransform.transform(p, m_tmpPoint);
<a name="l01166"></a>01166         rotateAbs(m_tmpPoint, theta);
<a name="l01167"></a>01167     }    
<a name="l01168"></a>01168     
<a name="l01176"></a><a class="code" href="classprefuse_1_1_display.html#a2ed26aed855aa0272a861bfa373712be">01176</a>     <span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keywordtype">void</span> <a class="code" href="classprefuse_1_1_display.html#a2ed26aed855aa0272a861bfa373712be">rotateAbs</a>(<span class="keyword">final</span> Point2D p, <span class="keywordtype">double</span> theta) {
<a name="l01177"></a>01177         <span class="keywordtype">double</span> zx = p.getX(), zy = p.getY();
<a name="l01178"></a>01178         damageReport();
<a name="l01179"></a>01179         m_transform.translate(zx, zy);
<a name="l01180"></a>01180         m_transform.rotate(theta);
<a name="l01181"></a>01181         m_transform.translate(-zx, -zy);
<a name="l01182"></a>01182         <span class="keywordflow">try</span> {
<a name="l01183"></a>01183             m_itransform = m_transform.createInverse();
<a name="l01184"></a>01184         } <span class="keywordflow">catch</span> ( Exception e ) { <span class="comment">/*will never happen here*/</span> }
<a name="l01185"></a>01185     }
<a name="l01186"></a>01186 
<a name="l01194"></a><a class="code" href="classprefuse_1_1_display.html#a99a576c548a990fe9cace5daa40484c5">01194</a>     <span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keywordtype">void</span> <a class="code" href="classprefuse_1_1_display.html#a99a576c548a990fe9cace5daa40484c5">animatePan</a>(<span class="keywordtype">double</span> dx, <span class="keywordtype">double</span> dy, <span class="keywordtype">long</span> duration) {
<a name="l01195"></a>01195         <span class="keywordtype">double</span> panx = dx / m_transform.getScaleX();
<a name="l01196"></a>01196         <span class="keywordtype">double</span> pany = dy / m_transform.getScaleY();
<a name="l01197"></a>01197         animatePanAbs(panx,pany,duration);
<a name="l01198"></a>01198     }
<a name="l01199"></a>01199     
<a name="l01207"></a><a class="code" href="classprefuse_1_1_display.html#af77a92d1ddca44202df7481596dae129">01207</a>     <span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keywordtype">void</span> <a class="code" href="classprefuse_1_1_display.html#af77a92d1ddca44202df7481596dae129">animatePanAbs</a>(<span class="keywordtype">double</span> dx, <span class="keywordtype">double</span> dy, <span class="keywordtype">long</span> duration) {
<a name="l01208"></a>01208         m_transact.pan(dx,dy,duration);
<a name="l01209"></a>01209     }
<a name="l01210"></a>01210     
<a name="l01217"></a><a class="code" href="classprefuse_1_1_display.html#a264a9ae3b60d5008ac90e00ddb080e4c">01217</a>     <span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keywordtype">void</span> <a class="code" href="classprefuse_1_1_display.html#a264a9ae3b60d5008ac90e00ddb080e4c">animatePanTo</a>(Point2D p, <span class="keywordtype">long</span> duration) {
<a name="l01218"></a>01218         Point2D pp = <span class="keyword">new</span> Point2D.Double();
<a name="l01219"></a>01219         m_itransform.transform(p,pp);
<a name="l01220"></a>01220         animatePanToAbs(pp,duration);
<a name="l01221"></a>01221     }
<a name="l01222"></a>01222     
<a name="l01229"></a><a class="code" href="classprefuse_1_1_display.html#a2d281abab068daaa99f1fc1d0733ba92">01229</a>     <span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keywordtype">void</span> <a class="code" href="classprefuse_1_1_display.html#a2d281abab068daaa99f1fc1d0733ba92">animatePanToAbs</a>(Point2D p, <span class="keywordtype">long</span> duration) {
<a name="l01230"></a>01230         m_tmpPoint.setLocation(0,0);
<a name="l01231"></a>01231         m_itransform.transform(m_tmpPoint,m_tmpPoint);
<a name="l01232"></a>01232         <span class="keywordtype">double</span> x = p.getX(); x = (Double.isNaN(x) ? 0 : x);
<a name="l01233"></a>01233         <span class="keywordtype">double</span> y = p.getY(); y = (Double.isNaN(y) ? 0 : y);
<a name="l01234"></a>01234         <span class="keywordtype">double</span> w = getWidth() /(2*m_transform.getScaleX());
<a name="l01235"></a>01235         <span class="keywordtype">double</span> h = getHeight()/(2*m_transform.getScaleY());
<a name="l01236"></a>01236         <span class="keywordtype">double</span> dx = w-x+m_tmpPoint.getX();
<a name="l01237"></a>01237         <span class="keywordtype">double</span> dy = h-y+m_tmpPoint.getY();
<a name="l01238"></a>01238         animatePanAbs(dx,dy,duration);
<a name="l01239"></a>01239     }
<a name="l01240"></a>01240     
<a name="l01248"></a><a class="code" href="classprefuse_1_1_display.html#a7609c85dad33ede2ad4d187b90dcaca9">01248</a>     <span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keywordtype">void</span> <a class="code" href="classprefuse_1_1_display.html#a7609c85dad33ede2ad4d187b90dcaca9">animateZoom</a>(<span class="keyword">final</span> Point2D p, <span class="keywordtype">double</span> scale, <span class="keywordtype">long</span> duration) {
<a name="l01249"></a>01249         Point2D pp = <span class="keyword">new</span> Point2D.Double();
<a name="l01250"></a>01250         m_itransform.transform(p,pp);
<a name="l01251"></a>01251         animateZoomAbs(pp,scale,duration);
<a name="l01252"></a>01252     }
<a name="l01253"></a>01253     
<a name="l01261"></a><a class="code" href="classprefuse_1_1_display.html#a6473fe826bb7d0ad5db4112eca3bb036">01261</a>     <span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keywordtype">void</span> <a class="code" href="classprefuse_1_1_display.html#a6473fe826bb7d0ad5db4112eca3bb036">animateZoomAbs</a>(<span class="keyword">final</span> Point2D p, <span class="keywordtype">double</span> scale, <span class="keywordtype">long</span> duration) {
<a name="l01262"></a>01262         m_transact.zoom(p,scale,duration);
<a name="l01263"></a>01263     }
<a name="l01264"></a>01264     
<a name="l01272"></a><a class="code" href="classprefuse_1_1_display.html#aa81ababef19e47da3a6822ab694862f1">01272</a>     <span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keywordtype">void</span> <a class="code" href="classprefuse_1_1_display.html#aa81ababef19e47da3a6822ab694862f1">animatePanAndZoomTo</a>(<span class="keyword">final</span> Point2D p, <span class="keywordtype">double</span> scale, <span class="keywordtype">long</span> duration) {
<a name="l01273"></a>01273         Point2D pp = <span class="keyword">new</span> Point2D.Double();
<a name="l01274"></a>01274         m_itransform.transform(p,pp);
<a name="l01275"></a>01275         animatePanAndZoomToAbs(pp,scale,duration);
<a name="l01276"></a>01276     }
<a name="l01277"></a>01277     
<a name="l01285"></a><a class="code" href="classprefuse_1_1_display.html#a22dc0257cd4ebcb5764c65c6a7e1f594">01285</a>     <span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keywordtype">void</span> <a class="code" href="classprefuse_1_1_display.html#a22dc0257cd4ebcb5764c65c6a7e1f594">animatePanAndZoomToAbs</a>(<span class="keyword">final</span> Point2D p, <span class="keywordtype">double</span> scale, <span class="keywordtype">long</span> duration) {
<a name="l01286"></a>01286         m_transact.panAndZoom(p,scale,duration);
<a name="l01287"></a>01287     }
<a name="l01288"></a>01288     
<a name="l01293"></a><a class="code" href="classprefuse_1_1_display.html#ae51f59242b45885b2d9f6796c7d4abff">01293</a>     <span class="keyword">public</span> <span class="keywordtype">boolean</span> <a class="code" href="classprefuse_1_1_display.html#ae51f59242b45885b2d9f6796c7d4abff">isTranformInProgress</a>() {
<a name="l01294"></a>01294         <span class="keywordflow">return</span> m_transact.isRunning();
<a name="l01295"></a>01295     }
<a name="l01296"></a>01296     
<a name="l01300"></a>01300     <span class="keyword">private</span> <span class="keyword">class </span>TransformActivity <span class="keyword">extends</span> Activity {
<a name="l01301"></a>01301         <span class="comment">// TODO: clean this up to be more general...</span>
<a name="l01302"></a>01302         <span class="comment">// TODO: change mechanism so that multiple transform</span>
<a name="l01303"></a>01303         <span class="comment">//        activities can be running at once?</span>
<a name="l01304"></a>01304          
<a name="l01305"></a>01305         <span class="keyword">private</span> <span class="keywordtype">double</span>[] src, dst;
<a name="l01306"></a>01306         <span class="keyword">private</span> AffineTransform m_at;
<a name="l01307"></a>01307         <span class="keyword">public</span> TransformActivity(<a class="code" href="classprefuse_1_1_visualization.html">Visualization</a> vis) {
<a name="l01308"></a>01308             super(vis, 2000,20,0);
<a name="l01309"></a>01309             src = <span class="keyword">new</span> <span class="keywordtype">double</span>[6];
<a name="l01310"></a>01310             dst = <span class="keyword">new</span> <span class="keywordtype">double</span>[6];
<a name="l01311"></a>01311             m_at = <span class="keyword">new</span> AffineTransform();
<a name="l01312"></a>01312             setPacingFunction(<span class="keyword">new</span> SlowInSlowOutPacer());
<a name="l01313"></a>01313         }
<a name="l01314"></a>01314         <span class="keyword">private</span> AffineTransform getTransform() {
<a name="l01315"></a>01315             <span class="keywordflow">if</span> ( this.isScheduled() )
<a name="l01316"></a>01316                 m_at.setTransform(dst[0],dst[1],dst[2],dst[3],dst[4],dst[5]);
<a name="l01317"></a>01317             <span class="keywordflow">else</span>
<a name="l01318"></a>01318                 m_at.setTransform(m_transform);
<a name="l01319"></a>01319             <span class="keywordflow">return</span> m_at;
<a name="l01320"></a>01320         }
<a name="l01321"></a>01321         
<a name="l01322"></a>01322         <span class="keyword">public</span> <span class="keywordtype">void</span> panAndZoom(<span class="keyword">final</span> Point2D p, <span class="keywordtype">double</span> scale, <span class="keywordtype">long</span> duration) {
<a name="l01323"></a>01323             AffineTransform at = getTransform();
<a name="l01324"></a>01324             this.cancel(m_vis);
<a name="l01325"></a>01325             setDuration(duration);
<a name="l01326"></a>01326             
<a name="l01327"></a>01327             m_tmpPoint.setLocation(0,0);
<a name="l01328"></a>01328             m_itransform.transform(m_tmpPoint,m_tmpPoint);
<a name="l01329"></a>01329             <span class="keywordtype">double</span> x = p.getX(); x = (Double.isNaN(x) ? 0 : x);
<a name="l01330"></a>01330             <span class="keywordtype">double</span> y = p.getY(); y = (Double.isNaN(y) ? 0 : y);
<a name="l01331"></a>01331             <span class="keywordtype">double</span> w = getWidth() /(2*m_transform.getScaleX());
<a name="l01332"></a>01332             <span class="keywordtype">double</span> h = getHeight()/(2*m_transform.getScaleY());
<a name="l01333"></a>01333             <span class="keywordtype">double</span> dx = w-x+m_tmpPoint.getX();
<a name="l01334"></a>01334             <span class="keywordtype">double</span> dy = h-y+m_tmpPoint.getY();
<a name="l01335"></a>01335             at.translate(dx,dy);
<a name="l01336"></a>01336 
<a name="l01337"></a>01337             at.translate(p.getX(), p.getY());
<a name="l01338"></a>01338             at.scale(scale,scale);
<a name="l01339"></a>01339             at.translate(-p.getX(), -p.getY());
<a name="l01340"></a>01340             
<a name="l01341"></a>01341             at.getMatrix(dst);
<a name="l01342"></a>01342             m_transform.getMatrix(src);
<a name="l01343"></a>01343             this.run();
<a name="l01344"></a>01344         }
<a name="l01345"></a>01345         <span class="keyword">public</span> <span class="keywordtype">void</span> pan(<span class="keywordtype">double</span> dx, <span class="keywordtype">double</span> dy, <span class="keywordtype">long</span> duration) {
<a name="l01346"></a>01346             AffineTransform at = getTransform();
<a name="l01347"></a>01347             this.cancel(m_vis);
<a name="l01348"></a>01348             setDuration(duration);
<a name="l01349"></a>01349             at.translate(dx,dy);
<a name="l01350"></a>01350             at.getMatrix(dst);
<a name="l01351"></a>01351             m_transform.getMatrix(src);
<a name="l01352"></a>01352             this.run();
<a name="l01353"></a>01353         }
<a name="l01354"></a>01354         <span class="keyword">public</span> <span class="keywordtype">void</span> zoom(<span class="keyword">final</span> Point2D p, <span class="keywordtype">double</span> scale, <span class="keywordtype">long</span> duration) {
<a name="l01355"></a>01355             AffineTransform at = getTransform();
<a name="l01356"></a>01356             this.cancel(m_vis);
<a name="l01357"></a>01357             setDuration(duration);
<a name="l01358"></a>01358             <span class="keywordtype">double</span> zx = p.getX(), zy = p.getY();
<a name="l01359"></a>01359             at.translate(zx, zy);
<a name="l01360"></a>01360             at.scale(scale,scale);
<a name="l01361"></a>01361             at.translate(-zx, -zy);
<a name="l01362"></a>01362             at.getMatrix(dst);
<a name="l01363"></a>01363             m_transform.getMatrix(src);
<a name="l01364"></a>01364             this.run();
<a name="l01365"></a>01365         }
<a name="l01366"></a>01366         <span class="keyword">protected</span> <span class="keywordtype">void</span> run(<span class="keywordtype">long</span> elapsedTime) {
<a name="l01367"></a>01367             <span class="keywordtype">double</span> f = getPace(elapsedTime);
<a name="l01368"></a>01368             damageReport();
<a name="l01369"></a>01369             m_transform.setTransform(
<a name="l01370"></a>01370                 src[0] + f*(dst[0]-src[0]),
<a name="l01371"></a>01371                 src[1] + f*(dst[1]-src[1]),
<a name="l01372"></a>01372                 src[2] + f*(dst[2]-src[2]),
<a name="l01373"></a>01373                 src[3] + f*(dst[3]-src[3]),
<a name="l01374"></a>01374                 src[4] + f*(dst[4]-src[4]),
<a name="l01375"></a>01375                 src[5] + f*(dst[5]-src[5])
<a name="l01376"></a>01376             );
<a name="l01377"></a>01377             <span class="keywordflow">try</span> {
<a name="l01378"></a>01378                 m_itransform = m_transform.createInverse();
<a name="l01379"></a>01379             } <span class="keywordflow">catch</span> ( Exception e ) { <span class="comment">/* won&#39;t happen */</span> }
<a name="l01380"></a>01380             repaint();
<a name="l01381"></a>01381         }
<a name="l01382"></a>01382     } <span class="comment">// end of inner class TransformActivity</span>
<a name="l01383"></a>01383     
<a name="l01384"></a>01384     <span class="comment">// ------------------------------------------------------------------------</span>
<a name="l01385"></a>01385     <span class="comment">// Paint Listeners</span>
<a name="l01386"></a>01386     
<a name="l01392"></a><a class="code" href="classprefuse_1_1_display.html#aadfa0e843e16fda4ecb22b4ea12ea51d">01392</a>     <span class="keyword">public</span> <span class="keywordtype">void</span> <a class="code" href="classprefuse_1_1_display.html#aadfa0e843e16fda4ecb22b4ea12ea51d">addPaintListener</a>(PaintListener pl) {
<a name="l01393"></a>01393         <span class="keywordflow">if</span> ( m_painters == null )
<a name="l01394"></a>01394             m_painters = <span class="keyword">new</span> CopyOnWriteArrayList();
<a name="l01395"></a>01395         m_painters.add(pl);
<a name="l01396"></a>01396     }
<a name="l01397"></a>01397     
<a name="l01402"></a><a class="code" href="classprefuse_1_1_display.html#a38c249c62ca5df7df2c0040ce8a3d80b">01402</a>     <span class="keyword">public</span> <span class="keywordtype">void</span> <a class="code" href="classprefuse_1_1_display.html#a38c249c62ca5df7df2c0040ce8a3d80b">removePaintListener</a>(PaintListener pl) {
<a name="l01403"></a>01403         m_painters.remove(pl);
<a name="l01404"></a>01404     }
<a name="l01405"></a>01405     
<a name="l01410"></a><a class="code" href="classprefuse_1_1_display.html#aac1b757eae35866141f1282b83a50cdc">01410</a>     <span class="keyword">protected</span> <span class="keywordtype">void</span> <a class="code" href="classprefuse_1_1_display.html#aac1b757eae35866141f1282b83a50cdc">firePrePaint</a>(Graphics2D g) {
<a name="l01411"></a>01411         <span class="keywordflow">if</span> ( m_painters != null &amp;&amp; m_painters.size() &gt; 0 ) {
<a name="l01412"></a>01412             Object[] lstnrs = m_painters.getArray();
<a name="l01413"></a>01413             <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> i=0; i&lt;lstnrs.length; ++i ) {
<a name="l01414"></a>01414                 <span class="keywordflow">try</span> {
<a name="l01415"></a>01415                     ((PaintListener)lstnrs[i]).prePaint(<span class="keyword">this</span>, g);
<a name="l01416"></a>01416                 } <span class="keywordflow">catch</span> ( Exception e ) {
<a name="l01417"></a>01417                     s_logger.warning(
<a name="l01418"></a>01418                         <span class="stringliteral">&quot;Exception thrown by PaintListener: &quot;</span> + e + <span class="stringliteral">&quot;\n&quot;</span> +
<a name="l01419"></a>01419                         StringLib.getStackTrace(e));
<a name="l01420"></a>01420                 }
<a name="l01421"></a>01421             }
<a name="l01422"></a>01422         }
<a name="l01423"></a>01423     }
<a name="l01424"></a>01424     
<a name="l01429"></a><a class="code" href="classprefuse_1_1_display.html#a87785dbdc9cb8d8d5669c0b80a74d737">01429</a>     <span class="keyword">protected</span> <span class="keywordtype">void</span> <a class="code" href="classprefuse_1_1_display.html#a87785dbdc9cb8d8d5669c0b80a74d737">firePostPaint</a>(Graphics2D g) {
<a name="l01430"></a>01430         <span class="keywordflow">if</span> ( m_painters != null &amp;&amp; m_painters.size() &gt; 0 ) {
<a name="l01431"></a>01431             Object[] lstnrs = m_painters.getArray();
<a name="l01432"></a>01432             <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> i=0; i&lt;lstnrs.length; ++i ) {
<a name="l01433"></a>01433                 <span class="keywordflow">try</span> {
<a name="l01434"></a>01434                     ((PaintListener)lstnrs[i]).postPaint(<span class="keyword">this</span>, g);
<a name="l01435"></a>01435                 } <span class="keywordflow">catch</span> ( Exception e ) {
<a name="l01436"></a>01436                     s_logger.warning(
<a name="l01437"></a>01437                         <span class="stringliteral">&quot;Exception thrown by PaintListener: &quot;</span> + e + <span class="stringliteral">&quot;\n&quot;</span> +
<a name="l01438"></a>01438                         StringLib.getStackTrace(e));
<a name="l01439"></a>01439                 }
<a name="l01440"></a>01440             }
<a name="l01441"></a>01441         }
<a name="l01442"></a>01442     }
<a name="l01443"></a>01443     
<a name="l01444"></a>01444     
<a name="l01445"></a>01445     <span class="comment">// ------------------------------------------------------------------------</span>
<a name="l01446"></a>01446     <span class="comment">// Item Bounds Listeners</span>
<a name="l01447"></a>01447     
<a name="l01453"></a><a class="code" href="classprefuse_1_1_display.html#a3d604fbbdc84af318ff74b42195e1986">01453</a>     <span class="keyword">public</span> <span class="keywordtype">void</span> <a class="code" href="classprefuse_1_1_display.html#a3d604fbbdc84af318ff74b42195e1986">addItemBoundsListener</a>(ItemBoundsListener ibl) {
<a name="l01454"></a>01454         <span class="keywordflow">if</span> ( m_bounders == null )
<a name="l01455"></a>01455             m_bounders = <span class="keyword">new</span> CopyOnWriteArrayList();
<a name="l01456"></a>01456         m_bounders.add(ibl);
<a name="l01457"></a>01457     }
<a name="l01458"></a>01458     
<a name="l01464"></a><a class="code" href="classprefuse_1_1_display.html#a092ec1921c7ab89559f3957dbd81b5b9">01464</a>     <span class="keyword">public</span> <span class="keywordtype">void</span> <a class="code" href="classprefuse_1_1_display.html#a092ec1921c7ab89559f3957dbd81b5b9">removeItemBoundsListener</a>(ItemBoundsListener ibl) {
<a name="l01465"></a>01465         m_bounders.remove(ibl);
<a name="l01466"></a>01466     }
<a name="l01467"></a>01467     
<a name="l01472"></a><a class="code" href="classprefuse_1_1_display.html#ae84f94e13dd6055337750fb72c332ddb">01472</a>     <span class="keyword">protected</span> <span class="keywordtype">void</span> <a class="code" href="classprefuse_1_1_display.html#ae84f94e13dd6055337750fb72c332ddb">checkItemBoundsChanged</a>(Rectangle2D prev) {
<a name="l01473"></a>01473         <span class="keywordflow">if</span> ( m_bounds.equals(prev) )
<a name="l01474"></a>01474             <span class="keywordflow">return</span>; <span class="comment">// nothing to do</span>
<a name="l01475"></a>01475         
<a name="l01476"></a>01476         <span class="keywordflow">if</span> ( m_bounders != null &amp;&amp; m_bounders.size() &gt; 0 ) {
<a name="l01477"></a>01477             Object[] lstnrs = m_bounders.getArray();
<a name="l01478"></a>01478             <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> i=0; i&lt;lstnrs.length; ++i ) {
<a name="l01479"></a>01479                 <span class="keywordflow">try</span> {
<a name="l01480"></a>01480                     ((ItemBoundsListener)lstnrs[i]).itemBoundsChanged(<span class="keyword">this</span>);
<a name="l01481"></a>01481                 } <span class="keywordflow">catch</span> ( Exception e ) {
<a name="l01482"></a>01482                     s_logger.warning(
<a name="l01483"></a>01483                         <span class="stringliteral">&quot;Exception thrown by ItemBoundsListener: &quot;</span> + e + <span class="stringliteral">&quot;\n&quot;</span> +
<a name="l01484"></a>01484                         StringLib.getStackTrace(e));
<a name="l01485"></a>01485                 }
<a name="l01486"></a>01486             }
<a name="l01487"></a>01487         }
<a name="l01488"></a>01488     }
<a name="l01489"></a>01489     
<a name="l01490"></a>01490     
<a name="l01491"></a>01491     <span class="comment">// ------------------------------------------------------------------------</span>
<a name="l01492"></a>01492     <span class="comment">// Control Listeners</span>
<a name="l01493"></a>01493     
<a name="l01498"></a><a class="code" href="classprefuse_1_1_display.html#a5dbf3c1ca016ae968fd80b141834b894">01498</a>     <span class="keyword">public</span> <span class="keywordtype">void</span> <a class="code" href="classprefuse_1_1_display.html#a5dbf3c1ca016ae968fd80b141834b894">addControlListener</a>(Control cl) {
<a name="l01499"></a>01499         m_controls.add(cl);
<a name="l01500"></a>01500     }
<a name="l01501"></a>01501 
<a name="l01506"></a><a class="code" href="classprefuse_1_1_display.html#ac574997eb21fef4c2f2a6098da6c698d">01506</a>     <span class="keyword">public</span> <span class="keywordtype">void</span> <a class="code" href="classprefuse_1_1_display.html#ac574997eb21fef4c2f2a6098da6c698d">removeControlListener</a>(Control cl) {
<a name="l01507"></a>01507         m_controls.remove(cl);
<a name="l01508"></a>01508     }
<a name="l01509"></a>01509     
<a name="l01515"></a><a class="code" href="classprefuse_1_1_display.html#ab323d3e8b4552599490ba2fcc6067f94">01515</a>     <span class="keyword">public</span> <span class="keyword">synchronized</span> VisualItem <a class="code" href="classprefuse_1_1_display.html#ab323d3e8b4552599490ba2fcc6067f94">findItem</a>(Point p) {
<a name="l01516"></a>01516         <span class="comment">// transform mouse point from screen space to item space</span>
<a name="l01517"></a>01517         Point2D p2 = (m_itransform==null ? p : 
<a name="l01518"></a>01518                       m_itransform.transform(p, m_tmpPoint));
<a name="l01519"></a>01519         <span class="comment">// ensure that the picking queue has been z-sorted</span>
<a name="l01520"></a>01520         <span class="keywordflow">if</span> ( !m_queue.psorted )
<a name="l01521"></a>01521             m_queue.sortPickingQueue();
<a name="l01522"></a>01522         <span class="comment">// walk queue from front to back looking for hits</span>
<a name="l01523"></a>01523         <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> i = m_queue.psize; --i &gt;= 0; ) {
<a name="l01524"></a>01524             VisualItem vi = m_queue.pitems[i];
<a name="l01525"></a>01525             <span class="keywordflow">if</span> ( !vi.isValid() ) <span class="keywordflow">continue</span>; <span class="comment">// in case tuple went invalid</span>
<a name="l01526"></a>01526             Renderer r = vi.getRenderer();
<a name="l01527"></a>01527             <span class="keywordflow">if</span> (r!=null &amp;&amp; vi.isInteractive() &amp;&amp; r.locatePoint(p2, vi)) {
<a name="l01528"></a>01528                 <span class="keywordflow">return</span> vi;
<a name="l01529"></a>01529             }
<a name="l01530"></a>01530         }
<a name="l01531"></a>01531         <span class="keywordflow">return</span> null;
<a name="l01532"></a>01532     }
<a name="l01533"></a>01533     
<a name="l01538"></a><a class="code" href="classprefuse_1_1_display_1_1_input_event_capturer.html">01538</a>     <span class="keyword">public</span> <span class="keyword">class </span><a class="code" href="classprefuse_1_1_display_1_1_input_event_capturer.html">InputEventCapturer</a> <span class="keyword">implements</span> MouseMotionListener, 
<a name="l01539"></a>01539         MouseWheelListener, MouseListener, KeyListener
<a name="l01540"></a>01540     {
<a name="l01541"></a>01541         <span class="keyword">private</span> VisualItem activeItem = null;
<a name="l01542"></a>01542         <span class="keyword">private</span> <span class="keywordtype">boolean</span> mouseDown = <span class="keyword">false</span>;
<a name="l01543"></a>01543 
<a name="l01544"></a>01544         <span class="keyword">private</span> <span class="keywordtype">boolean</span> validityCheck() {
<a name="l01545"></a>01545             <span class="keywordflow">if</span> ( activeItem.isValid() )
<a name="l01546"></a>01546                 <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l01547"></a>01547             activeItem = null;
<a name="l01548"></a>01548             <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01549"></a>01549         }
<a name="l01550"></a>01550         
<a name="l01551"></a>01551         <span class="keyword">public</span> <span class="keywordtype">void</span> mouseDragged(MouseEvent e) {
<a name="l01552"></a>01552             <span class="keyword">synchronized</span> ( m_vis ) {
<a name="l01553"></a>01553                 <span class="keywordflow">if</span> ( activeItem != null ) {
<a name="l01554"></a>01554                     <span class="keywordflow">if</span> ( validityCheck() )
<a name="l01555"></a>01555                         fireItemDragged(activeItem, e);
<a name="l01556"></a>01556                 } <span class="keywordflow">else</span> {
<a name="l01557"></a>01557                     fireMouseDragged(e);
<a name="l01558"></a>01558                 }
<a name="l01559"></a>01559             }
<a name="l01560"></a>01560         }
<a name="l01561"></a>01561 
<a name="l01562"></a>01562         <span class="keyword">public</span> <span class="keywordtype">void</span> mouseMoved(MouseEvent e) {
<a name="l01563"></a>01563             <span class="keyword">synchronized</span> ( m_vis ) {
<a name="l01564"></a>01564                 <span class="keywordtype">boolean</span> earlyReturn = <span class="keyword">false</span>;
<a name="l01565"></a>01565                 <span class="comment">//check if we&#39;ve gone over any item</span>
<a name="l01566"></a>01566                 VisualItem vi = findItem(e.getPoint());
<a name="l01567"></a>01567                 <span class="keywordflow">if</span> ( activeItem != null &amp;&amp; activeItem != vi ) {
<a name="l01568"></a>01568                     <span class="keywordflow">if</span> ( validityCheck() )
<a name="l01569"></a>01569                         fireItemExited(activeItem, e);
<a name="l01570"></a>01570                     earlyReturn = <span class="keyword">true</span>;
<a name="l01571"></a>01571                 }
<a name="l01572"></a>01572                 <span class="keywordflow">if</span> ( vi != null &amp;&amp; vi != activeItem ) {
<a name="l01573"></a>01573                     fireItemEntered(vi, e);
<a name="l01574"></a>01574                     earlyReturn = <span class="keyword">true</span>;
<a name="l01575"></a>01575                 }
<a name="l01576"></a>01576                 activeItem = vi;
<a name="l01577"></a>01577                 <span class="keywordflow">if</span> ( earlyReturn ) <span class="keywordflow">return</span>;
<a name="l01578"></a>01578                 
<a name="l01579"></a>01579                 <span class="keywordflow">if</span> ( vi != null &amp;&amp; vi == activeItem ) {
<a name="l01580"></a>01580                     fireItemMoved(vi, e);
<a name="l01581"></a>01581                 }
<a name="l01582"></a>01582                 <span class="keywordflow">if</span> ( vi == null ) {
<a name="l01583"></a>01583                     fireMouseMoved(e);
<a name="l01584"></a>01584                 }
<a name="l01585"></a>01585             }
<a name="l01586"></a>01586         }
<a name="l01587"></a>01587 
<a name="l01588"></a>01588         <span class="keyword">public</span> <span class="keywordtype">void</span> mouseWheelMoved(MouseWheelEvent e) {
<a name="l01589"></a>01589             <span class="keyword">synchronized</span> ( m_vis ) {
<a name="l01590"></a>01590                 <span class="keywordflow">if</span> ( activeItem != null ) {
<a name="l01591"></a>01591                     <span class="keywordflow">if</span> ( validityCheck() )
<a name="l01592"></a>01592                         fireItemWheelMoved(activeItem, e);
<a name="l01593"></a>01593                 } <span class="keywordflow">else</span> {
<a name="l01594"></a>01594                     fireMouseWheelMoved(e);
<a name="l01595"></a>01595                 }
<a name="l01596"></a>01596             }
<a name="l01597"></a>01597         }
<a name="l01598"></a>01598 
<a name="l01599"></a>01599         <span class="keyword">public</span> <span class="keywordtype">void</span> mouseClicked(MouseEvent e) {
<a name="l01600"></a>01600             <span class="keyword">synchronized</span> ( m_vis ) {
<a name="l01601"></a>01601                 <span class="keywordflow">if</span> ( activeItem != null ) {
<a name="l01602"></a>01602                     <span class="keywordflow">if</span> ( validityCheck() )
<a name="l01603"></a>01603                         fireItemClicked(activeItem, e);
<a name="l01604"></a>01604                 } <span class="keywordflow">else</span> {
<a name="l01605"></a>01605                     fireMouseClicked(e);
<a name="l01606"></a>01606                 }
<a name="l01607"></a>01607             }
<a name="l01608"></a>01608         }
<a name="l01609"></a>01609         
<a name="l01610"></a>01610 
<a name="l01611"></a>01611         <span class="keyword">public</span> <span class="keywordtype">void</span> mousePressed(MouseEvent e) {
<a name="l01612"></a>01612             <span class="keyword">synchronized</span> ( m_vis ) {
<a name="l01613"></a>01613                 mouseDown = <span class="keyword">true</span>;
<a name="l01614"></a>01614                 <span class="keywordflow">if</span> ( activeItem != null ) {
<a name="l01615"></a>01615                     <span class="keywordflow">if</span> ( validityCheck() )
<a name="l01616"></a>01616                         fireItemPressed(activeItem, e);
<a name="l01617"></a>01617                 } <span class="keywordflow">else</span> {
<a name="l01618"></a>01618                     fireMousePressed(e);
<a name="l01619"></a>01619                 }
<a name="l01620"></a>01620             }
<a name="l01621"></a>01621         }
<a name="l01622"></a>01622 
<a name="l01623"></a>01623         <span class="keyword">public</span> <span class="keywordtype">void</span> mouseReleased(MouseEvent e) {
<a name="l01624"></a>01624             <span class="keyword">synchronized</span> ( m_vis ) {
<a name="l01625"></a>01625                 <span class="keywordflow">if</span> ( activeItem != null ) {
<a name="l01626"></a>01626                     <span class="keywordflow">if</span> ( validityCheck() )
<a name="l01627"></a>01627                         fireItemReleased(activeItem, e);
<a name="l01628"></a>01628                 } <span class="keywordflow">else</span> {
<a name="l01629"></a>01629                     fireMouseReleased(e);
<a name="l01630"></a>01630                 }
<a name="l01631"></a>01631                 <span class="keywordflow">if</span> ( activeItem != null &amp;&amp; mouseDown &amp;&amp; isOffComponent(e) ) {
<a name="l01632"></a>01632                     <span class="comment">// mouse was dragged off of the component, </span>
<a name="l01633"></a>01633                     <span class="comment">// then released, so register an exit</span>
<a name="l01634"></a>01634                     fireItemExited(activeItem, e);
<a name="l01635"></a>01635                     activeItem = null;
<a name="l01636"></a>01636                 }
<a name="l01637"></a>01637                 mouseDown = <span class="keyword">false</span>;
<a name="l01638"></a>01638             }
<a name="l01639"></a>01639         }
<a name="l01640"></a>01640 
<a name="l01641"></a>01641         <span class="keyword">public</span> <span class="keywordtype">void</span> mouseEntered(MouseEvent e) {
<a name="l01642"></a>01642             <span class="keyword">synchronized</span> ( m_vis ) {
<a name="l01643"></a>01643                 fireMouseEntered(e);
<a name="l01644"></a>01644             }
<a name="l01645"></a>01645         }
<a name="l01646"></a>01646 
<a name="l01647"></a>01647         <span class="keyword">public</span> <span class="keywordtype">void</span> mouseExited(MouseEvent e) {
<a name="l01648"></a>01648             <span class="keyword">synchronized</span> ( m_vis ) {      
<a name="l01649"></a>01649                 <span class="keywordflow">if</span> ( !mouseDown &amp;&amp; activeItem != null ) {
<a name="l01650"></a>01650                     <span class="comment">// we&#39;ve left the component and an item </span>
<a name="l01651"></a>01651                     <span class="comment">// is active but not being dragged, deactivate it</span>
<a name="l01652"></a>01652                     fireItemExited(activeItem, e);
<a name="l01653"></a>01653                     activeItem = null;
<a name="l01654"></a>01654                 }
<a name="l01655"></a>01655                 fireMouseExited(e);
<a name="l01656"></a>01656             }
<a name="l01657"></a>01657         }
<a name="l01658"></a>01658 
<a name="l01659"></a>01659         <span class="keyword">public</span> <span class="keywordtype">void</span> keyPressed(KeyEvent e) {
<a name="l01660"></a>01660             <span class="keyword">synchronized</span> ( m_vis ) {
<a name="l01661"></a>01661                 <span class="keywordflow">if</span> ( activeItem != null ) {
<a name="l01662"></a>01662                     <span class="keywordflow">if</span> ( validityCheck() )
<a name="l01663"></a>01663                         fireItemKeyPressed(activeItem, e);
<a name="l01664"></a>01664                 } <span class="keywordflow">else</span> {
<a name="l01665"></a>01665                     fireKeyPressed(e);
<a name="l01666"></a>01666                 }
<a name="l01667"></a>01667             }
<a name="l01668"></a>01668         }
<a name="l01669"></a>01669 
<a name="l01670"></a>01670         <span class="keyword">public</span> <span class="keywordtype">void</span> keyReleased(KeyEvent e) {
<a name="l01671"></a>01671             <span class="keyword">synchronized</span> ( m_vis ) {
<a name="l01672"></a>01672                 <span class="keywordflow">if</span> ( activeItem != null ) {
<a name="l01673"></a>01673                     <span class="keywordflow">if</span> ( validityCheck() )
<a name="l01674"></a>01674                         fireItemKeyReleased(activeItem, e);
<a name="l01675"></a>01675                 } <span class="keywordflow">else</span> {
<a name="l01676"></a>01676                     fireKeyReleased(e);
<a name="l01677"></a>01677                 }
<a name="l01678"></a>01678             }
<a name="l01679"></a>01679         }
<a name="l01680"></a>01680 
<a name="l01681"></a>01681         <span class="keyword">public</span> <span class="keywordtype">void</span> keyTyped(KeyEvent e) {
<a name="l01682"></a>01682             <span class="keyword">synchronized</span> ( m_vis ) {
<a name="l01683"></a>01683                 <span class="keywordflow">if</span> ( activeItem != null ) {
<a name="l01684"></a>01684                     <span class="keywordflow">if</span> ( validityCheck() )
<a name="l01685"></a>01685                         fireItemKeyTyped(activeItem, e);
<a name="l01686"></a>01686                 } <span class="keywordflow">else</span> {
<a name="l01687"></a>01687                     fireKeyTyped(e);
<a name="l01688"></a>01688                 }
<a name="l01689"></a>01689             }
<a name="l01690"></a>01690         }
<a name="l01691"></a>01691         
<a name="l01692"></a>01692         <span class="keyword">private</span> <span class="keywordtype">boolean</span> isOffComponent(MouseEvent e) {
<a name="l01693"></a>01693             <span class="keywordtype">int</span> x = e.getX(), y = e.getY();
<a name="l01694"></a>01694             <span class="keywordflow">return</span> ( x&lt;0 || x&gt;getWidth() || y&lt;0 || y&gt;getHeight() );
<a name="l01695"></a>01695         }
<a name="l01696"></a>01696         
<a name="l01697"></a>01697         <span class="comment">// --------------------------------------------------------------------</span>
<a name="l01698"></a>01698         <span class="comment">// Fire Event Notifications</span>
<a name="l01699"></a>01699         
<a name="l01700"></a>01700         <span class="keyword">private</span> <span class="keywordtype">void</span> fireItemDragged(VisualItem item, MouseEvent e) {
<a name="l01701"></a>01701             Object[] lstnrs = m_controls.getArray();
<a name="l01702"></a>01702             <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; lstnrs.length; ++i) {
<a name="l01703"></a>01703                 Control ctrl = (Control) lstnrs[i];
<a name="l01704"></a>01704                 <span class="keywordflow">if</span> (ctrl.isEnabled())
<a name="l01705"></a>01705                     <span class="keywordflow">try</span> {
<a name="l01706"></a>01706                         ctrl.itemDragged(item, e);
<a name="l01707"></a>01707                     } <span class="keywordflow">catch</span> ( Exception ex ) {
<a name="l01708"></a>01708                         s_logger.warning(
<a name="l01709"></a>01709                             <span class="stringliteral">&quot;Exception thrown by Control: &quot;</span> + ex + <span class="stringliteral">&quot;\n&quot;</span> +
<a name="l01710"></a>01710                             StringLib.getStackTrace(ex));
<a name="l01711"></a>01711                     }
<a name="l01712"></a>01712             }
<a name="l01713"></a>01713         }
<a name="l01714"></a>01714 
<a name="l01715"></a>01715         <span class="keyword">private</span> <span class="keywordtype">void</span> fireItemMoved(VisualItem item, MouseEvent e) {
<a name="l01716"></a>01716             Object[] lstnrs = m_controls.getArray();
<a name="l01717"></a>01717             <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; lstnrs.length; ++i) {
<a name="l01718"></a>01718                 Control ctrl = (Control) lstnrs[i];
<a name="l01719"></a>01719                 <span class="keywordflow">if</span> (ctrl.isEnabled())
<a name="l01720"></a>01720                     <span class="keywordflow">try</span> {
<a name="l01721"></a>01721                         ctrl.itemMoved(item, e);
<a name="l01722"></a>01722                     } <span class="keywordflow">catch</span> ( Exception ex ) {
<a name="l01723"></a>01723                         s_logger.warning(
<a name="l01724"></a>01724                             <span class="stringliteral">&quot;Exception thrown by Control: &quot;</span> + ex + <span class="stringliteral">&quot;\n&quot;</span> +
<a name="l01725"></a>01725                             StringLib.getStackTrace(ex));
<a name="l01726"></a>01726                     }
<a name="l01727"></a>01727             }
<a name="l01728"></a>01728         }
<a name="l01729"></a>01729 
<a name="l01730"></a>01730         <span class="keyword">private</span> <span class="keywordtype">void</span> fireItemWheelMoved(VisualItem item, MouseWheelEvent e) {
<a name="l01731"></a>01731             Object[] lstnrs = m_controls.getArray();
<a name="l01732"></a>01732             <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; lstnrs.length; ++i) {
<a name="l01733"></a>01733                 Control ctrl = (Control) lstnrs[i];
<a name="l01734"></a>01734                 <span class="keywordflow">if</span> (ctrl.isEnabled())
<a name="l01735"></a>01735                     <span class="keywordflow">try</span> {
<a name="l01736"></a>01736                         ctrl.itemWheelMoved(item, e);
<a name="l01737"></a>01737                     } <span class="keywordflow">catch</span> ( Exception ex ) {
<a name="l01738"></a>01738                         s_logger.warning(
<a name="l01739"></a>01739                             <span class="stringliteral">&quot;Exception thrown by Control: &quot;</span> + ex + <span class="stringliteral">&quot;\n&quot;</span> +
<a name="l01740"></a>01740                             StringLib.getStackTrace(ex));
<a name="l01741"></a>01741                     }
<a name="l01742"></a>01742             }
<a name="l01743"></a>01743         }
<a name="l01744"></a>01744 
<a name="l01745"></a>01745         <span class="keyword">private</span> <span class="keywordtype">void</span> fireItemClicked(VisualItem item, MouseEvent e) {
<a name="l01746"></a>01746             Object[] lstnrs = m_controls.getArray();
<a name="l01747"></a>01747             <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; lstnrs.length; ++i) {
<a name="l01748"></a>01748                 Control ctrl = (Control) lstnrs[i];
<a name="l01749"></a>01749                 <span class="keywordflow">if</span> (ctrl.isEnabled())
<a name="l01750"></a>01750                     <span class="keywordflow">try</span> {
<a name="l01751"></a>01751                         ctrl.itemClicked(item, e);
<a name="l01752"></a>01752                     } <span class="keywordflow">catch</span> ( Exception ex ) {
<a name="l01753"></a>01753                         s_logger.warning(
<a name="l01754"></a>01754                             <span class="stringliteral">&quot;Exception thrown by Control: &quot;</span> + ex + <span class="stringliteral">&quot;\n&quot;</span> +
<a name="l01755"></a>01755                             StringLib.getStackTrace(ex));
<a name="l01756"></a>01756                     }
<a name="l01757"></a>01757             }
<a name="l01758"></a>01758         }
<a name="l01759"></a>01759 
<a name="l01760"></a>01760         <span class="keyword">private</span> <span class="keywordtype">void</span> fireItemPressed(VisualItem item, MouseEvent e) {
<a name="l01761"></a>01761             Object[] lstnrs = m_controls.getArray();
<a name="l01762"></a>01762             <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; lstnrs.length; ++i) {
<a name="l01763"></a>01763                 Control ctrl = (Control) lstnrs[i];
<a name="l01764"></a>01764                 <span class="keywordflow">if</span> (ctrl.isEnabled())
<a name="l01765"></a>01765                     <span class="keywordflow">try</span> {
<a name="l01766"></a>01766                         ctrl.itemPressed(item, e);
<a name="l01767"></a>01767                     } <span class="keywordflow">catch</span> ( Exception ex ) {
<a name="l01768"></a>01768                         s_logger.warning(
<a name="l01769"></a>01769                             <span class="stringliteral">&quot;Exception thrown by Control: &quot;</span> + ex + <span class="stringliteral">&quot;\n&quot;</span> +
<a name="l01770"></a>01770                             StringLib.getStackTrace(ex));
<a name="l01771"></a>01771                     }
<a name="l01772"></a>01772             }
<a name="l01773"></a>01773         }
<a name="l01774"></a>01774 
<a name="l01775"></a>01775         <span class="keyword">private</span> <span class="keywordtype">void</span> fireItemReleased(VisualItem item, MouseEvent e) {
<a name="l01776"></a>01776             Object[] lstnrs = m_controls.getArray();
<a name="l01777"></a>01777             <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; lstnrs.length; ++i) {
<a name="l01778"></a>01778                 Control ctrl = (Control) lstnrs[i];
<a name="l01779"></a>01779                 <span class="keywordflow">if</span> (ctrl.isEnabled())
<a name="l01780"></a>01780                     <span class="keywordflow">try</span> {
<a name="l01781"></a>01781                         ctrl.itemReleased(item, e);
<a name="l01782"></a>01782                     } <span class="keywordflow">catch</span> ( Exception ex ) {
<a name="l01783"></a>01783                         s_logger.warning(
<a name="l01784"></a>01784                             <span class="stringliteral">&quot;Exception thrown by Control: &quot;</span> + ex + <span class="stringliteral">&quot;\n&quot;</span> +
<a name="l01785"></a>01785                             StringLib.getStackTrace(ex));
<a name="l01786"></a>01786                     }
<a name="l01787"></a>01787             }
<a name="l01788"></a>01788         }
<a name="l01789"></a>01789 
<a name="l01790"></a>01790         <span class="keyword">private</span> <span class="keywordtype">void</span> fireItemEntered(VisualItem item, MouseEvent e) {
<a name="l01791"></a>01791             item.setHover(<span class="keyword">true</span>);
<a name="l01792"></a>01792             Object[] lstnrs = m_controls.getArray();
<a name="l01793"></a>01793             <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; lstnrs.length; ++i) {
<a name="l01794"></a>01794                 Control ctrl = (Control) lstnrs[i];
<a name="l01795"></a>01795                 <span class="keywordflow">if</span> (ctrl.isEnabled())
<a name="l01796"></a>01796                     <span class="keywordflow">try</span> {
<a name="l01797"></a>01797                         ctrl.itemEntered(item, e);
<a name="l01798"></a>01798                     } <span class="keywordflow">catch</span> ( Exception ex ) {
<a name="l01799"></a>01799                         s_logger.warning(
<a name="l01800"></a>01800                             <span class="stringliteral">&quot;Exception thrown by Control: &quot;</span> + ex + <span class="stringliteral">&quot;\n&quot;</span> +
<a name="l01801"></a>01801                             StringLib.getStackTrace(ex));
<a name="l01802"></a>01802                     }
<a name="l01803"></a>01803             }
<a name="l01804"></a>01804         }
<a name="l01805"></a>01805 
<a name="l01806"></a>01806         <span class="keyword">private</span> <span class="keywordtype">void</span> fireItemExited(VisualItem item, MouseEvent e) {
<a name="l01807"></a>01807             <span class="keywordflow">if</span> ( item.isValid() ) item.setHover(<span class="keyword">false</span>);
<a name="l01808"></a>01808             Object[] lstnrs = m_controls.getArray();
<a name="l01809"></a>01809             <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; lstnrs.length; ++i) {
<a name="l01810"></a>01810                 Control ctrl = (Control) lstnrs[i];
<a name="l01811"></a>01811                 <span class="keywordflow">if</span> (ctrl.isEnabled())
<a name="l01812"></a>01812                     <span class="keywordflow">try</span> {
<a name="l01813"></a>01813                         ctrl.itemExited(item, e);
<a name="l01814"></a>01814                     } <span class="keywordflow">catch</span> ( Exception ex ) {
<a name="l01815"></a>01815                         s_logger.warning(
<a name="l01816"></a>01816                             <span class="stringliteral">&quot;Exception thrown by Control: &quot;</span> + ex + <span class="stringliteral">&quot;\n&quot;</span> +
<a name="l01817"></a>01817                             StringLib.getStackTrace(ex));
<a name="l01818"></a>01818                     }
<a name="l01819"></a>01819             }
<a name="l01820"></a>01820         }
<a name="l01821"></a>01821 
<a name="l01822"></a>01822         <span class="keyword">private</span> <span class="keywordtype">void</span> fireItemKeyPressed(VisualItem item, KeyEvent e) {
<a name="l01823"></a>01823             Object[] lstnrs = m_controls.getArray();
<a name="l01824"></a>01824             <span class="keywordflow">if</span> (lstnrs.length == 0)
<a name="l01825"></a>01825                 <span class="keywordflow">return</span>;
<a name="l01826"></a>01826             <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; lstnrs.length; ++i) {
<a name="l01827"></a>01827                 Control ctrl = (Control) lstnrs[i];
<a name="l01828"></a>01828                 <span class="keywordflow">if</span> (ctrl.isEnabled())
<a name="l01829"></a>01829                     <span class="keywordflow">try</span> {
<a name="l01830"></a>01830                         ctrl.itemKeyPressed(item, e);
<a name="l01831"></a>01831                     } <span class="keywordflow">catch</span> ( Exception ex ) {
<a name="l01832"></a>01832                         s_logger.warning(
<a name="l01833"></a>01833                             <span class="stringliteral">&quot;Exception thrown by Control: &quot;</span> + ex + <span class="stringliteral">&quot;\n&quot;</span> +
<a name="l01834"></a>01834                             StringLib.getStackTrace(ex));
<a name="l01835"></a>01835                     }
<a name="l01836"></a>01836             }
<a name="l01837"></a>01837         }
<a name="l01838"></a>01838 
<a name="l01839"></a>01839         <span class="keyword">private</span> <span class="keywordtype">void</span> fireItemKeyReleased(VisualItem item, KeyEvent e) {
<a name="l01840"></a>01840             Object[] lstnrs = m_controls.getArray();
<a name="l01841"></a>01841             <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; lstnrs.length; ++i) {
<a name="l01842"></a>01842                 Control ctrl = (Control) lstnrs[i];
<a name="l01843"></a>01843                 <span class="keywordflow">if</span> (ctrl.isEnabled())
<a name="l01844"></a>01844                     <span class="keywordflow">try</span> {
<a name="l01845"></a>01845                         ctrl.itemKeyReleased(item, e);
<a name="l01846"></a>01846                     } <span class="keywordflow">catch</span> ( Exception ex ) {
<a name="l01847"></a>01847                         s_logger.warning(
<a name="l01848"></a>01848                             <span class="stringliteral">&quot;Exception thrown by Control: &quot;</span> + ex + <span class="stringliteral">&quot;\n&quot;</span> +
<a name="l01849"></a>01849                             StringLib.getStackTrace(ex));
<a name="l01850"></a>01850                     }
<a name="l01851"></a>01851             }
<a name="l01852"></a>01852         }
<a name="l01853"></a>01853 
<a name="l01854"></a>01854         <span class="keyword">private</span> <span class="keywordtype">void</span> fireItemKeyTyped(VisualItem item, KeyEvent e) {
<a name="l01855"></a>01855             Object[] lstnrs = m_controls.getArray();
<a name="l01856"></a>01856             <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; lstnrs.length; ++i) {
<a name="l01857"></a>01857                 Control ctrl = (Control) lstnrs[i];
<a name="l01858"></a>01858                 <span class="keywordflow">if</span> (ctrl.isEnabled())
<a name="l01859"></a>01859                     <span class="keywordflow">try</span> {
<a name="l01860"></a>01860                         ctrl.itemKeyTyped(item, e);
<a name="l01861"></a>01861                     } <span class="keywordflow">catch</span> ( Exception ex ) {
<a name="l01862"></a>01862                         s_logger.warning(
<a name="l01863"></a>01863                             <span class="stringliteral">&quot;Exception thrown by Control: &quot;</span> + ex + <span class="stringliteral">&quot;\n&quot;</span> +
<a name="l01864"></a>01864                             StringLib.getStackTrace(ex));
<a name="l01865"></a>01865                     }
<a name="l01866"></a>01866             }
<a name="l01867"></a>01867         }
<a name="l01868"></a>01868 
<a name="l01869"></a>01869         <span class="keyword">private</span> <span class="keywordtype">void</span> fireMouseEntered(MouseEvent e) {
<a name="l01870"></a>01870             Object[] lstnrs = m_controls.getArray();
<a name="l01871"></a>01871             <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; lstnrs.length; ++i) {
<a name="l01872"></a>01872                 Control ctrl = (Control) lstnrs[i];
<a name="l01873"></a>01873                 <span class="keywordflow">if</span> (ctrl.isEnabled())
<a name="l01874"></a>01874                     <span class="keywordflow">try</span> {
<a name="l01875"></a>01875                         ctrl.mouseEntered(e);
<a name="l01876"></a>01876                     } <span class="keywordflow">catch</span> ( Exception ex ) {
<a name="l01877"></a>01877                         s_logger.warning(
<a name="l01878"></a>01878                             <span class="stringliteral">&quot;Exception thrown by Control: &quot;</span> + ex + <span class="stringliteral">&quot;\n&quot;</span> +
<a name="l01879"></a>01879                             StringLib.getStackTrace(ex));
<a name="l01880"></a>01880                     }
<a name="l01881"></a>01881             }
<a name="l01882"></a>01882         }
<a name="l01883"></a>01883 
<a name="l01884"></a>01884         <span class="keyword">private</span> <span class="keywordtype">void</span> fireMouseExited(MouseEvent e) {
<a name="l01885"></a>01885             Object[] lstnrs = m_controls.getArray();
<a name="l01886"></a>01886             <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; lstnrs.length; ++i) {
<a name="l01887"></a>01887                 Control ctrl = (Control) lstnrs[i];
<a name="l01888"></a>01888                 <span class="keywordflow">if</span> (ctrl.isEnabled())
<a name="l01889"></a>01889                     <span class="keywordflow">try</span> {
<a name="l01890"></a>01890                         ctrl.mouseExited(e);
<a name="l01891"></a>01891                     } <span class="keywordflow">catch</span> ( Exception ex ) {
<a name="l01892"></a>01892                         s_logger.warning(
<a name="l01893"></a>01893                             <span class="stringliteral">&quot;Exception thrown by Control: &quot;</span> + ex + <span class="stringliteral">&quot;\n&quot;</span> +
<a name="l01894"></a>01894                             StringLib.getStackTrace(ex));
<a name="l01895"></a>01895                     }
<a name="l01896"></a>01896             }
<a name="l01897"></a>01897         }
<a name="l01898"></a>01898 
<a name="l01899"></a>01899         <span class="keyword">private</span> <span class="keywordtype">void</span> fireMousePressed(MouseEvent e) {
<a name="l01900"></a>01900             Object[] lstnrs = m_controls.getArray();
<a name="l01901"></a>01901             <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; lstnrs.length; ++i) {
<a name="l01902"></a>01902                 Control ctrl = (Control) lstnrs[i];
<a name="l01903"></a>01903                 <span class="keywordflow">if</span> (ctrl.isEnabled())
<a name="l01904"></a>01904                     <span class="keywordflow">try</span> {
<a name="l01905"></a>01905                         ctrl.mousePressed(e);
<a name="l01906"></a>01906                     } <span class="keywordflow">catch</span> ( Exception ex ) {
<a name="l01907"></a>01907                         s_logger.warning(
<a name="l01908"></a>01908                             <span class="stringliteral">&quot;Exception thrown by Control: &quot;</span> + ex + <span class="stringliteral">&quot;\n&quot;</span> +
<a name="l01909"></a>01909                             StringLib.getStackTrace(ex));
<a name="l01910"></a>01910                     }
<a name="l01911"></a>01911             }
<a name="l01912"></a>01912         }
<a name="l01913"></a>01913 
<a name="l01914"></a>01914         <span class="keyword">private</span> <span class="keywordtype">void</span> fireMouseReleased(MouseEvent e) {
<a name="l01915"></a>01915             Object[] lstnrs = m_controls.getArray();
<a name="l01916"></a>01916             <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; lstnrs.length; ++i) {
<a name="l01917"></a>01917                 Control ctrl = (Control) lstnrs[i];
<a name="l01918"></a>01918                 <span class="keywordflow">if</span> (ctrl.isEnabled())
<a name="l01919"></a>01919                     <span class="keywordflow">try</span> {
<a name="l01920"></a>01920                         ctrl.mouseReleased(e);
<a name="l01921"></a>01921                     } <span class="keywordflow">catch</span> ( Exception ex ) {
<a name="l01922"></a>01922                         s_logger.warning(
<a name="l01923"></a>01923                             <span class="stringliteral">&quot;Exception thrown by Control: &quot;</span> + ex + <span class="stringliteral">&quot;\n&quot;</span> +
<a name="l01924"></a>01924                             StringLib.getStackTrace(ex));
<a name="l01925"></a>01925                     }
<a name="l01926"></a>01926             }
<a name="l01927"></a>01927         }
<a name="l01928"></a>01928 
<a name="l01929"></a>01929         <span class="keyword">private</span> <span class="keywordtype">void</span> fireMouseClicked(MouseEvent e) {
<a name="l01930"></a>01930             Object[] lstnrs = m_controls.getArray();
<a name="l01931"></a>01931             <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; lstnrs.length; ++i) {
<a name="l01932"></a>01932                 Control ctrl = (Control) lstnrs[i];
<a name="l01933"></a>01933                 <span class="keywordflow">if</span> (ctrl.isEnabled())
<a name="l01934"></a>01934                     <span class="keywordflow">try</span> {
<a name="l01935"></a>01935                         ctrl.mouseClicked(e);
<a name="l01936"></a>01936                     } <span class="keywordflow">catch</span> ( Exception ex ) {
<a name="l01937"></a>01937                         s_logger.warning(
<a name="l01938"></a>01938                             <span class="stringliteral">&quot;Exception thrown by Control: &quot;</span> + ex + <span class="stringliteral">&quot;\n&quot;</span> +
<a name="l01939"></a>01939                             StringLib.getStackTrace(ex));
<a name="l01940"></a>01940                     }
<a name="l01941"></a>01941             }
<a name="l01942"></a>01942         }
<a name="l01943"></a>01943 
<a name="l01944"></a>01944         <span class="keyword">private</span> <span class="keywordtype">void</span> fireMouseDragged(MouseEvent e) {
<a name="l01945"></a>01945             Object[] lstnrs = m_controls.getArray();
<a name="l01946"></a>01946             <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; lstnrs.length; ++i) {
<a name="l01947"></a>01947                 Control ctrl = (Control) lstnrs[i];
<a name="l01948"></a>01948                 <span class="keywordflow">if</span> (ctrl.isEnabled())
<a name="l01949"></a>01949                     <span class="keywordflow">try</span> {
<a name="l01950"></a>01950                         ctrl.mouseDragged(e);
<a name="l01951"></a>01951                     } <span class="keywordflow">catch</span> ( Exception ex ) {
<a name="l01952"></a>01952                         s_logger.warning(
<a name="l01953"></a>01953                             <span class="stringliteral">&quot;Exception thrown by Control: &quot;</span> + ex + <span class="stringliteral">&quot;\n&quot;</span> +
<a name="l01954"></a>01954                             StringLib.getStackTrace(ex));
<a name="l01955"></a>01955                     }
<a name="l01956"></a>01956             }
<a name="l01957"></a>01957         }
<a name="l01958"></a>01958 
<a name="l01959"></a>01959         <span class="keyword">private</span> <span class="keywordtype">void</span> fireMouseMoved(MouseEvent e) {
<a name="l01960"></a>01960             Object[] lstnrs = m_controls.getArray();
<a name="l01961"></a>01961             <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; lstnrs.length; ++i) {
<a name="l01962"></a>01962                 Control ctrl = (Control) lstnrs[i];
<a name="l01963"></a>01963                 <span class="keywordflow">if</span> (ctrl.isEnabled())
<a name="l01964"></a>01964                     <span class="keywordflow">try</span> {
<a name="l01965"></a>01965                         ctrl.mouseMoved(e);
<a name="l01966"></a>01966                     } <span class="keywordflow">catch</span> ( Exception ex ) {
<a name="l01967"></a>01967                         s_logger.warning(
<a name="l01968"></a>01968                             <span class="stringliteral">&quot;Exception thrown by Control: &quot;</span> + ex + <span class="stringliteral">&quot;\n&quot;</span> +
<a name="l01969"></a>01969                             StringLib.getStackTrace(ex));
<a name="l01970"></a>01970                     }
<a name="l01971"></a>01971             }
<a name="l01972"></a>01972         }
<a name="l01973"></a>01973 
<a name="l01974"></a>01974         <span class="keyword">private</span> <span class="keywordtype">void</span> fireMouseWheelMoved(MouseWheelEvent e) {
<a name="l01975"></a>01975             Object[] lstnrs = m_controls.getArray();
<a name="l01976"></a>01976             <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; lstnrs.length; ++i) {
<a name="l01977"></a>01977                 Control ctrl = (Control) lstnrs[i];
<a name="l01978"></a>01978                 <span class="keywordflow">if</span> (ctrl.isEnabled())
<a name="l01979"></a>01979                     <span class="keywordflow">try</span> {
<a name="l01980"></a>01980                         ctrl.mouseWheelMoved(e);
<a name="l01981"></a>01981                     } <span class="keywordflow">catch</span> ( Exception ex ) {
<a name="l01982"></a>01982                         s_logger.warning(
<a name="l01983"></a>01983                             <span class="stringliteral">&quot;Exception thrown by Control: &quot;</span> + ex + <span class="stringliteral">&quot;\n&quot;</span> +
<a name="l01984"></a>01984                             StringLib.getStackTrace(ex));
<a name="l01985"></a>01985                     }
<a name="l01986"></a>01986             }
<a name="l01987"></a>01987         }
<a name="l01988"></a>01988 
<a name="l01989"></a>01989         <span class="keyword">private</span> <span class="keywordtype">void</span> fireKeyPressed(KeyEvent e) {
<a name="l01990"></a>01990             Object[] lstnrs = m_controls.getArray();
<a name="l01991"></a>01991             <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; lstnrs.length; ++i) {
<a name="l01992"></a>01992                 Control ctrl = (Control) lstnrs[i];
<a name="l01993"></a>01993                 <span class="keywordflow">if</span> (ctrl.isEnabled())
<a name="l01994"></a>01994                     <span class="keywordflow">try</span> {
<a name="l01995"></a>01995                         ctrl.keyPressed(e);
<a name="l01996"></a>01996                     } <span class="keywordflow">catch</span> ( Exception ex ) {
<a name="l01997"></a>01997                         s_logger.warning(
<a name="l01998"></a>01998                             <span class="stringliteral">&quot;Exception thrown by Control: &quot;</span> + ex + <span class="stringliteral">&quot;\n&quot;</span> +
<a name="l01999"></a>01999                             StringLib.getStackTrace(ex));
<a name="l02000"></a>02000                     }
<a name="l02001"></a>02001             }
<a name="l02002"></a>02002         }
<a name="l02003"></a>02003 
<a name="l02004"></a>02004         <span class="keyword">private</span> <span class="keywordtype">void</span> fireKeyReleased(KeyEvent e) {
<a name="l02005"></a>02005             Object[] lstnrs = m_controls.getArray();
<a name="l02006"></a>02006             <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; lstnrs.length; ++i) {
<a name="l02007"></a>02007                 Control ctrl = (Control) lstnrs[i];
<a name="l02008"></a>02008                 <span class="keywordflow">if</span> (ctrl.isEnabled())
<a name="l02009"></a>02009                     <span class="keywordflow">try</span> {
<a name="l02010"></a>02010                         ctrl.keyReleased(e);
<a name="l02011"></a>02011                     } <span class="keywordflow">catch</span> ( Exception ex ) {
<a name="l02012"></a>02012                         s_logger.warning(
<a name="l02013"></a>02013                             <span class="stringliteral">&quot;Exception thrown by Control: &quot;</span> + ex + <span class="stringliteral">&quot;\n&quot;</span> +
<a name="l02014"></a>02014                             StringLib.getStackTrace(ex));
<a name="l02015"></a>02015                     }
<a name="l02016"></a>02016             }
<a name="l02017"></a>02017         }
<a name="l02018"></a>02018 
<a name="l02019"></a>02019         <span class="keyword">private</span> <span class="keywordtype">void</span> fireKeyTyped(KeyEvent e) {
<a name="l02020"></a>02020             Object[] lstnrs = m_controls.getArray();
<a name="l02021"></a>02021             <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; lstnrs.length; ++i) {
<a name="l02022"></a>02022                 Control ctrl = (Control) lstnrs[i];
<a name="l02023"></a>02023                 <span class="keywordflow">if</span> (ctrl.isEnabled())
<a name="l02024"></a>02024                     <span class="keywordflow">try</span> {
<a name="l02025"></a>02025                         ctrl.keyTyped(e);
<a name="l02026"></a>02026                     } <span class="keywordflow">catch</span> ( Exception ex ) {
<a name="l02027"></a>02027                         s_logger.warning(
<a name="l02028"></a>02028                             <span class="stringliteral">&quot;Exception thrown by Control: &quot;</span> + ex + <span class="stringliteral">&quot;\n&quot;</span> +
<a name="l02029"></a>02029                             StringLib.getStackTrace(ex));
<a name="l02030"></a>02030                     }
<a name="l02031"></a>02031             }
<a name="l02032"></a>02032         }
<a name="l02033"></a>02033         
<a name="l02034"></a>02034     } <span class="comment">// end of inner class MouseEventCapturer</span>
<a name="l02035"></a>02035     
<a name="l02036"></a>02036     
<a name="l02037"></a>02037     <span class="comment">// ------------------------------------------------------------------------</span>
<a name="l02038"></a>02038     <span class="comment">// Text Editing</span>
<a name="l02039"></a>02039     
<a name="l02044"></a><a class="code" href="classprefuse_1_1_display.html#a7328a5071f4f672b9bbd8f1d1b0f82ab">02044</a>     <span class="keyword">public</span> JTextComponent <a class="code" href="classprefuse_1_1_display.html#a7328a5071f4f672b9bbd8f1d1b0f82ab">getTextEditor</a>() {
<a name="l02045"></a>02045         <span class="keywordflow">return</span> m_editor;
<a name="l02046"></a>02046     }
<a name="l02047"></a>02047     
<a name="l02052"></a><a class="code" href="classprefuse_1_1_display.html#a63c4a46117591c6785116f2e86217978">02052</a>     <span class="keyword">public</span> <span class="keywordtype">void</span> <a class="code" href="classprefuse_1_1_display.html#a63c4a46117591c6785116f2e86217978">setTextEditor</a>(JTextComponent tc) {
<a name="l02053"></a>02053         this.<span class="keyword">remove</span>(m_editor);
<a name="l02054"></a>02054         m_editor = tc;
<a name="l02055"></a>02055         this.add(m_editor, 1);
<a name="l02056"></a>02056     }
<a name="l02057"></a>02057     
<a name="l02066"></a><a class="code" href="classprefuse_1_1_display.html#a16b51d77ce8e53bcb2bd3c0cd5e4b331">02066</a>     <span class="keyword">public</span> <span class="keywordtype">void</span> <a class="code" href="classprefuse_1_1_display.html#a16b51d77ce8e53bcb2bd3c0cd5e4b331">editText</a>(VisualItem item, String attribute) {
<a name="l02067"></a>02067         <span class="keywordflow">if</span> ( m_editing ) { stopEditing(); }
<a name="l02068"></a>02068         Rectangle2D b = item.getBounds();
<a name="l02069"></a>02069         Rectangle r = m_transform.createTransformedShape(b).getBounds();
<a name="l02070"></a>02070         
<a name="l02071"></a>02071         <span class="comment">// hacky placement code that attempts to keep text in same place</span>
<a name="l02072"></a>02072         <span class="comment">// configured under Windows XP and Java 1.4.2b</span>
<a name="l02073"></a>02073         <span class="keywordflow">if</span> ( m_editor instanceof JTextArea ) {
<a name="l02074"></a>02074             r.y -= 2; r.width += 22; r.height += 2;
<a name="l02075"></a>02075         } <span class="keywordflow">else</span> {
<a name="l02076"></a>02076             r.x += 3; r.y += 1; r.width -= 5; r.height -= 2;
<a name="l02077"></a>02077         }
<a name="l02078"></a>02078         
<a name="l02079"></a>02079         Font f = getFont();
<a name="l02080"></a>02080         <span class="keywordtype">int</span> size = (int)Math.round(f.getSize()*m_transform.getScaleX());
<a name="l02081"></a>02081         Font nf = <span class="keyword">new</span> Font(f.getFontName(), f.getStyle(), size);
<a name="l02082"></a>02082         m_editor.setFont(nf);
<a name="l02083"></a>02083         
<a name="l02084"></a>02084         editText(item, attribute, r);
<a name="l02085"></a>02085     }
<a name="l02086"></a>02086     
<a name="l02097"></a><a class="code" href="classprefuse_1_1_display.html#a96213104a161d10d05bfc7614bf8f4f0">02097</a>     <span class="keyword">public</span> <span class="keywordtype">void</span> <a class="code" href="classprefuse_1_1_display.html#a96213104a161d10d05bfc7614bf8f4f0">editText</a>(VisualItem item, String attribute, Rectangle r) {
<a name="l02098"></a>02098         <span class="keywordflow">if</span> ( m_editing ) { stopEditing(); }
<a name="l02099"></a>02099         String txt = item.getString(attribute);
<a name="l02100"></a>02100         m_editItem = item;
<a name="l02101"></a>02101         m_editAttribute = attribute;
<a name="l02102"></a>02102         Color tc = ColorLib.getColor(item.getTextColor());
<a name="l02103"></a>02103         Color fc = ColorLib.getColor(item.getFillColor());
<a name="l02104"></a>02104         m_editor.setForeground(tc);
<a name="l02105"></a>02105         m_editor.setBackground(fc);
<a name="l02106"></a>02106         editText(txt, r);
<a name="l02107"></a>02107     }
<a name="l02108"></a>02108     
<a name="l02118"></a><a class="code" href="classprefuse_1_1_display.html#a36ababbdd78593a097f9f054f813b232">02118</a>     <span class="keyword">public</span> <span class="keywordtype">void</span> <a class="code" href="classprefuse_1_1_display.html#a36ababbdd78593a097f9f054f813b232">editText</a>(String txt, Rectangle r) {
<a name="l02119"></a>02119         <span class="keywordflow">if</span> ( m_editing ) { stopEditing(); }
<a name="l02120"></a>02120         m_editing = <span class="keyword">true</span>;
<a name="l02121"></a>02121         m_editor.setBounds(r.x,r.y,r.width,r.height);
<a name="l02122"></a>02122         m_editor.setText(txt);
<a name="l02123"></a>02123         m_editor.setVisible(<span class="keyword">true</span>);
<a name="l02124"></a>02124         m_editor.setCaretPosition(txt.length());
<a name="l02125"></a>02125         m_editor.requestFocus();
<a name="l02126"></a>02126     }
<a name="l02127"></a>02127     
<a name="l02134"></a><a class="code" href="classprefuse_1_1_display.html#a8dd4a897585b2f808173575a41e4aeda">02134</a>     <span class="keyword">public</span> <span class="keywordtype">void</span> <a class="code" href="classprefuse_1_1_display.html#a8dd4a897585b2f808173575a41e4aeda">stopEditing</a>() {
<a name="l02135"></a>02135         m_editor.setVisible(<span class="keyword">false</span>);
<a name="l02136"></a>02136         <span class="keywordflow">if</span> ( m_editItem != null ) {
<a name="l02137"></a>02137             String txt = m_editor.getText();
<a name="l02138"></a>02138             m_editItem.set(m_editAttribute, txt);
<a name="l02139"></a>02139             m_editItem = null;
<a name="l02140"></a>02140             m_editAttribute = null;
<a name="l02141"></a>02141             m_editor.setBackground(null);
<a name="l02142"></a>02142             m_editor.setForeground(null);
<a name="l02143"></a>02143         }
<a name="l02144"></a>02144         m_editing = <span class="keyword">false</span>;
<a name="l02145"></a>02145     }
<a name="l02146"></a>02146     
<a name="l02147"></a>02147 } <span class="comment">// end of class Display</span>
</pre></div></div><!-- contents -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Variables</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>



<hr class="footer"/><address class="footer"><small>
Generated on Wed Jan 18 2012 13:45:59 for Demo by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.7.6.1
</small></address>

</body>
</html>
